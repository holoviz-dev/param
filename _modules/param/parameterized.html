

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>param.parameterized &#8212; param v2.1.0rc1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsite.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/notebook.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alert.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/scroller.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>
    window.goatcounter = {
        path: function(p) { return location.host + p }
    }
</script>
    <script async="async" data-goatcounter="https://holoviz.goatcounter.com/count" src="../../_static/js/goatcounter.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/param/parameterized';</script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo_horizontal.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/logo_horizontal.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting_started.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user_guide/index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../reference/index.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../releases.html">
                        Releases
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../upgrade_guide.html">
                        Upgrade Guide
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../comparisons.html">
                        Comparisons
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../roadmap.html">
                        Roadmap
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer_guide.html">
                        Developer Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../about.html">
                        About
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/holoviz/param" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/holoviz_org" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discourse.holoviz.org/" title="Discourse" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-discourse"></i></span>
            <label class="sr-only">Discourse</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discord.gg/AXRHnJU6sP" title="Discord" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-discord"></i></span>
            <label class="sr-only">Discord</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting_started.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user_guide/index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../reference/index.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../releases.html">
                        Releases
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../upgrade_guide.html">
                        Upgrade Guide
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../comparisons.html">
                        Comparisons
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../roadmap.html">
                        Roadmap
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer_guide.html">
                        Developer Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../about.html">
                        About
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/holoviz/param" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/holoviz_org" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discourse.holoviz.org/" title="Discourse" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-discourse"></i></span>
            <label class="sr-only">Discourse</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discord.gg/AXRHnJU6sP" title="Discord" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-discord"></i></span>
            <label class="sr-only">Discord</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../user_guide/index.html">User Guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/index.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/Simplifying_Codebases.html">Simplifying Codebases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/Parameters.html">Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/Parameter_Types.html">Parameter Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/Dependencies_and_Watchers.html">Dependencies and Watchers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/References.html">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/Reactive_Expressions.html">Reactive Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/Generators.html">Generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/Serialization_and_Persistence.html">Serialization and Persistence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/Outputs.html">Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/Logging_and_Warnings.html">Logging and Warnings</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../user_guide/ParameterizedFunctions.html">ParameterizedFunctions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/Dynamic_Parameters.html">Dynamic Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/How_Param_Works.html">How Param Works</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/index.html">API</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/param/index.html">Param</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/param/reactive.html">Reactive API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/param/parameterized_objects.html">Parameterized objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/param/parameterized_helpers.html">Parameterized helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/param/parameters.html">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/param/parameter_helpers.html">Parameter helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/param/param_namespace.html">Param namespace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/param/logging.html">Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/param/serialization.html">Serialization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/numbergen.html">Numbergen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrade_guide.html">Upgrade Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../comparisons.html">Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">param.parameterized</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for param.parameterized</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Generic support for objects with full-featured Parameters and</span>
<span class="sd">messaging.</span>

<span class="sd">This file comes from the Param library (https://github.com/holoviz/param)</span>
<span class="sd">but can be taken out of the param module and used on its own if desired,</span>
<span class="sd">either alone (providing basic Parameter support) or with param&#39;s</span>
<span class="sd">__init__.py (providing specialized Parameter types).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">html</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numbers</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># Allow this file to be used standalone if desired, albeit without JSON serialization</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">serializer</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">serializer</span> <span class="o">=</span> <span class="kc">None</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">namedtuple</span><span class="p">,</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span><span class="p">,</span> <span class="n">wraps</span><span class="p">,</span> <span class="n">reduce</span>
<span class="kn">from</span> <span class="nn">html</span> <span class="kn">import</span> <span class="n">escape</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span><span class="p">,</span> <span class="n">attrgetter</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="n">MethodType</span>

<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">DEBUG</span><span class="p">,</span> <span class="n">INFO</span><span class="p">,</span> <span class="n">WARNING</span><span class="p">,</span> <span class="n">ERROR</span><span class="p">,</span> <span class="n">CRITICAL</span>

<span class="kn">from</span> <span class="nn">._utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DEFAULT_SIGNATURE</span><span class="p">,</span>
    <span class="n">ParamDeprecationWarning</span> <span class="k">as</span> <span class="n">_ParamDeprecationWarning</span><span class="p">,</span>
    <span class="n">ParamFutureWarning</span> <span class="k">as</span> <span class="n">_ParamFutureWarning</span><span class="p">,</span>
    <span class="n">Skip</span><span class="p">,</span>
    <span class="n">_deprecated</span><span class="p">,</span>
    <span class="n">_deprecate_positional_args</span><span class="p">,</span>
    <span class="n">_dict_update</span><span class="p">,</span>
    <span class="n">_in_ipython</span><span class="p">,</span>
    <span class="n">_is_auto_name</span><span class="p">,</span>
    <span class="n">_is_mutable_container</span><span class="p">,</span>
    <span class="n">_recursive_repr</span><span class="p">,</span>
    <span class="n">_to_async_gen</span><span class="p">,</span>
    <span class="n">_validate_error_prefix</span><span class="p">,</span>
    <span class="n">accept_arguments</span><span class="p">,</span>
    <span class="n">iscoroutinefunction</span><span class="p">,</span>
    <span class="n">descendents</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Ideally setting param_pager would be in __init__.py but param_pager is</span>
<span class="c1"># needed on import to create the Parameterized class, so it&#39;d need to precede</span>
<span class="c1"># importing parameterized.py in __init__.py which would be a little weird.</span>
<span class="k">if</span> <span class="n">_in_ipython</span><span class="p">():</span>
    <span class="c1"># In case the optional ipython module is unavailable</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.ipython</span> <span class="kn">import</span> <span class="n">ParamPager</span><span class="p">,</span> <span class="n">ipython_async_executor</span> <span class="k">as</span> <span class="n">async_executor</span>
        <span class="n">param_pager</span> <span class="o">=</span> <span class="n">ParamPager</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Generates param description</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">._utils</span> <span class="kn">import</span> <span class="n">async_executor</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">._utils</span> <span class="kn">import</span> <span class="n">async_executor</span>
    <span class="n">param_pager</span> <span class="o">=</span> <span class="kc">None</span>


<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getfullargspec</span>

<span class="n">dt_types</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
<span class="n">_int_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">,)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="n">dt_types</span> <span class="o">=</span> <span class="n">dt_types</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">,)</span>
    <span class="n">_int_types</span> <span class="o">=</span> <span class="n">_int_types</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="n">VERBOSE</span> <span class="o">=</span> <span class="n">INFO</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">logging</span><span class="o">.</span><span class="n">addLevelName</span><span class="p">(</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="s2">&quot;VERBOSE&quot;</span><span class="p">)</span>

<span class="c1"># Get the appropriate logging.Logger instance. If `logger` is None, a</span>
<span class="c1"># logger named `&quot;param&quot;` will be instantiated. If `name` is set, a descendant</span>
<span class="c1"># logger with the name ``&quot;param.&lt;name&gt;&quot;`` is returned (or</span>
<span class="c1"># ``logger.name + &quot;.&lt;name&gt;&quot;``)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
<div class="viewcode-block" id="get_logger"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.get_logger.html#param.get_logger">[docs]</a><span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;param&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">root_logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
            <span class="n">root_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
                <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1">:</span><span class="si">%(name)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
            <span class="n">root_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">root_logger</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">root_logger</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span></div>


<span class="c1"># Indicates whether warnings should be raised as errors, stopping</span>
<span class="c1"># processing.</span>
<span class="n">warnings_as_exceptions</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">docstring_signature</span> <span class="o">=</span> <span class="kc">True</span>        <span class="c1"># Add signature to class docstrings</span>
<span class="n">docstring_describe_params</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Add parameter description to class</span>
                                  <span class="c1"># docstrings (requires ipython module)</span>
<span class="n">object_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">warning_count</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Hook to apply to depends and bind arguments to turn them into valid parameters</span>
<span class="n">_reference_transforms</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="register_reference_transform"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.register_reference_transform.html#param.register_reference_transform">[docs]</a><span class="k">def</span> <span class="nf">register_reference_transform</span><span class="p">(</span><span class="n">transform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Appends a transform to extract potential parameter dependencies</span>
<span class="sd">    from an object.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    transform: Callable[Any, Any]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_reference_transforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">transform_reference</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies transforms to turn objects which should be treated like</span>
<span class="sd">    a parameter reference into a valid reference that can be resolved</span>
<span class="sd">    by Param. This is useful for adding handling for depending on objects</span>
<span class="sd">    that are not simple Parameters or functions with dependency</span>
<span class="sd">    definitions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">transform</span> <span class="ow">in</span> <span class="n">_reference_transforms</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="s1">&#39;_dinfo&#39;</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arg</span>

<span class="k">def</span> <span class="nf">eval_function_with_deps</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluates a function after resolving its dependencies.</span>

<span class="sd">    Calls and returns a function after resolving any dependencies</span>
<span class="sd">    stored on the _dinfo attribute and passing the resolved values</span>
<span class="sd">    as arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="p">(),</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="s1">&#39;_dinfo&#39;</span><span class="p">):</span>
        <span class="n">arg_deps</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">_dinfo</span><span class="p">[</span><span class="s1">&#39;dependencies&#39;</span><span class="p">]</span>
        <span class="n">kw_deps</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">_dinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kw&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">kw_deps</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">arg_deps</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="n">dep</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">arg_deps</span><span class="p">)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="n">dep</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">kw_deps</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="resolve_value"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.resolve_value.html#param.resolve_value">[docs]</a><span class="k">def</span> <span class="nf">resolve_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resolves the current value of a dynamic reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)(</span><span class="n">resolve_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)((</span><span class="n">resolve_value</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">resolve_value</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">slice</span><span class="p">(</span>
            <span class="n">resolve_value</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">start</span><span class="p">),</span>
            <span class="n">resolve_value</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">stop</span><span class="p">),</span>
            <span class="n">resolve_value</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">transform_reference</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">is_gen</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isgeneratorfunction</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;_dinfo&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_gen</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">eval_function_with_deps</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_gen</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">_to_async_gen</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="resolve_ref"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.resolve_ref.html#param.resolve_ref">[docs]</a><span class="k">def</span> <span class="nf">resolve_ref</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resolves all parameters a dynamic reference depends on.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">)):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">reference</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resolve_ref</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">kv</span> <span class="ow">in</span> <span class="n">reference</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">kv</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resolve_ref</span><span class="p">(</span><span class="n">o</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">reference</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">reference</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">reference</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resolve_ref</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">transform_reference</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="s1">&#39;_dinfo&#39;</span><span class="p">):</span>
        <span class="n">dinfo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="s1">&#39;_dinfo&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dependencies&#39;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kw&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">refs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span><span class="n">args</span> <span class="o">+</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">owner</span> <span class="o">=</span> <span class="n">get_method_owner</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">owner</span><span class="o">.</span><span class="n">param</span><span class="p">:</span>
                    <span class="n">arg</span> <span class="o">=</span> <span class="n">owner</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                    <span class="n">arg</span> <span class="o">=</span> <span class="n">owner</span>
                    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">arg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
            <span class="n">refs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">resolve_ref</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">refs</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">reference</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[]</span></div>

<span class="k">def</span> <span class="nf">_identity_hook</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;To be removed when set_hook is removed&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">val</span>


<span class="k">class</span> <span class="nc">_Undefined</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dummy value to signal completely undefined values rather than</span>
<span class="sd">    simple None values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Haven&#39;t defined whether Undefined is falsy or truthy,</span>
        <span class="c1"># so to avoid subtle bugs raise an error when it</span>
        <span class="c1"># is used in a comparison without `is`.</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Use `is` to compare Undefined&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;Undefined&gt;&#39;</span>


<span class="n">Undefined</span> <span class="o">=</span> <span class="n">_Undefined</span><span class="p">()</span>


<div class="viewcode-block" id="logging_level"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.logging_level.html#param.logging_level">[docs]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">logging_level</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Temporarily modify param&#39;s logging level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">INFO</span><span class="p">,</span> <span class="n">WARNING</span><span class="p">,</span> <span class="n">ERROR</span><span class="p">,</span> <span class="n">CRITICAL</span><span class="p">,</span> <span class="n">VERBOSE</span><span class="p">]</span>
    <span class="n">level_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span> <span class="s1">&#39;CRITICAL&#39;</span><span class="p">,</span> <span class="s1">&#39;VERBOSE&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">level_names</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Level </span><span class="si">{</span><span class="n">level</span><span class="si">!r}</span><span class="s2"> not in </span><span class="si">{</span><span class="n">levels</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">param_logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">()</span>
    <span class="n">logging_level</span> <span class="o">=</span> <span class="n">param_logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">()</span>
    <span class="n">param_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="n">level_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">level</span><span class="p">)])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="kc">None</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">param_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging_level</span><span class="p">)</span></div>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">_batch_call_watchers</span><span class="p">(</span><span class="n">parameterized</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal version of batch_call_watchers, adding control over queueing and running.</span>
<span class="sd">    Only actually batches events if enable=True; otherwise a no-op. Only actually</span>
<span class="sd">    calls the accumulated watchers on exit if run=True; otherwise they remain queued.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">BATCH_WATCH</span> <span class="o">=</span> <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span>
    <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="n">enable</span> <span class="ow">or</span> <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="n">BATCH_WATCH</span>
        <span class="k">if</span> <span class="n">run</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">BATCH_WATCH</span><span class="p">:</span>
            <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_batch_call_watchers</span><span class="p">()</span>


<span class="c1"># PARAM3_DEPRECATION</span>
<div class="viewcode-block" id="batch_watch"><a class="viewcode-back" href="../../reference/param/generated/param.batch_watch.html#param.batch_watch">[docs]</a><span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;Use instead `batch_call_watchers`.&quot;</span><span class="p">)</span>
<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">batch_watch</span><span class="p">(</span><span class="n">parameterized</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">_batch_call_watchers</span><span class="p">(</span><span class="n">parameterized</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">run</span><span class="p">):</span>
        <span class="k">yield</span></div>


<div class="viewcode-block" id="batch_call_watchers"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.batch_call_watchers.html#param.batch_call_watchers">[docs]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">batch_call_watchers</span><span class="p">(</span><span class="n">parameterized</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Context manager to batch events to provide to Watchers on a</span>
<span class="sd">    parameterized object.  This context manager queues any events</span>
<span class="sd">    triggered by setting a parameter on the supplied parameterized</span>
<span class="sd">    object, saving them up to dispatch them all at once when the</span>
<span class="sd">    context manager exits.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">BATCH_WATCH</span> <span class="o">=</span> <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span>
    <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="n">BATCH_WATCH</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">BATCH_WATCH</span><span class="p">:</span>
            <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_batch_call_watchers</span><span class="p">()</span></div>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">_syncing</span><span class="p">(</span><span class="n">parameterized</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
    <span class="n">old</span> <span class="o">=</span> <span class="n">parameterized</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">syncing</span>
    <span class="n">parameterized</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">syncing</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">old</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">parameterized</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">syncing</span> <span class="o">=</span> <span class="n">old</span>


<div class="viewcode-block" id="edit_constant"><a class="viewcode-back" href="../../reference/param/generated/param.edit_constant.html#param.edit_constant">[docs]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">edit_constant</span><span class="p">(</span><span class="n">parameterized</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Temporarily set parameters on Parameterized object to constant=False</span>
<span class="sd">    to allow editing them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">&#39;existing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="n">constants</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">constant</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">const</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">constants</span><span class="p">):</span>
            <span class="n">p</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="n">const</span></div>


<div class="viewcode-block" id="discard_events"><a class="viewcode-back" href="../../reference/param/generated/param.discard_events.html#param.discard_events">[docs]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">discard_events</span><span class="p">(</span><span class="n">parameterized</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Context manager that discards any events within its scope</span>
<span class="sd">    triggered on the supplied parameterized object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">batch_watch</span> <span class="o">=</span> <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span>
    <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">watchers</span><span class="p">,</span> <span class="n">events</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_state_watchers</span><span class="p">),</span>
                        <span class="nb">list</span><span class="p">(</span><span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_events</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="n">batch_watch</span>
        <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_state_watchers</span> <span class="o">=</span> <span class="n">watchers</span>
        <span class="n">parameterized</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_events</span> <span class="o">=</span> <span class="n">events</span></div>


<span class="k">def</span> <span class="nf">classlist</span><span class="p">(</span><span class="n">class_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of the class hierarchy above (and including) the given class.</span>

<span class="sd">    Same as `inspect.getmro(class_)[::-1]`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="n">class_</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">get_all_slots</span><span class="p">(</span><span class="n">class_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of slot names for slots defined in `class_` and its</span>
<span class="sd">    superclasses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># A subclass&#39;s __slots__ attribute does not contain slots defined</span>
    <span class="c1"># in its superclass (the superclass&#39; __slots__ end up as</span>
    <span class="c1"># attributes of the subclass).</span>
    <span class="n">all_slots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">parent_param_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classlist</span><span class="p">(</span><span class="n">class_</span><span class="p">)[</span><span class="mi">1</span><span class="p">::]]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">parent_param_classes</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="s1">&#39;__slots__&#39;</span><span class="p">):</span>
            <span class="n">all_slots</span><span class="o">+=</span><span class="n">c</span><span class="o">.</span><span class="vm">__slots__</span>
    <span class="k">return</span> <span class="n">all_slots</span>


<span class="k">def</span> <span class="nf">get_occupied_slots</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of slots for which values have been set.</span>

<span class="sd">    (While a slot might be defined, if a value for that slot hasn&#39;t</span>
<span class="sd">    been set, then it&#39;s an AttributeError to request the slot&#39;s</span>
<span class="sd">    value.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">slot</span> <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">get_all_slots</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="n">slot</span><span class="p">)]</span>


<span class="c1"># PARAM3_DEPRECATION</span>
<span class="nd">@_deprecated</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">all_equal</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a single boolean for arg1==arg2, even for numpy arrays</span>
<span class="sd">    using element-wise comparison.</span>

<span class="sd">    Uses all(arg1==arg2) for sequences, and arg1==arg2 otherwise.</span>

<span class="sd">    If both objects have an &#39;_infinitely_iterable&#39; attribute, they are</span>
<span class="sd">    not be zipped together and are compared directly instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s1">&#39;_infinitely_iterable&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="p">[</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">]):</span>
        <span class="k">return</span> <span class="n">arg1</span><span class="o">==</span><span class="n">arg2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">a1</span> <span class="o">==</span> <span class="n">a2</span> <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arg1</span><span class="o">==</span><span class="n">arg2</span>


<span class="c1"># PARAM3_DEPRECATION</span>
<span class="c1"># The syntax to use a metaclass changed incompatibly between 2 and</span>
<span class="c1"># 3. The add_metaclass() class decorator below creates a class using a</span>
<span class="c1"># specified metaclass in a way that works on both 2 and 3. For 3, can</span>
<span class="c1"># remove this decorator and specify metaclasses in a simpler way</span>
<span class="c1"># (https://docs.python.org/3/reference/datamodel.html#customizing-class-creation)</span>
<span class="c1">#</span>
<span class="c1"># Code from six (https://bitbucket.org/gutworth/six; version 1.4.1).</span>
<span class="nd">@_deprecated</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">add_metaclass</span><span class="p">(</span><span class="n">metaclass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class decorator for creating a class with a metaclass.</span>

<span class="sd">    .. deprecated:: 2.0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">orig_vars</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">orig_vars</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;__dict__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">orig_vars</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;__weakref__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">slots_var</span> <span class="ow">in</span> <span class="n">orig_vars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__slots__&#39;</span><span class="p">,</span> <span class="p">()):</span>
            <span class="n">orig_vars</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">slots_var</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metaclass</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">,</span> <span class="n">orig_vars</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">class</span> <span class="nc">bothmethod</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &#39;optional @classmethod&#39;</span>

<span class="sd">    A decorator that allows a method to receive either the class</span>
<span class="sd">    object (if called on the class) or the instance object</span>
<span class="sd">    (if called on the instance) as its first argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Class call</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">owner</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Instance call</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">owner</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_getattrr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">_getattr</span><span class="p">,</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">+</span> <span class="n">attr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">no_instance_params</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Disables instance parameters on the class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">disable_instance_params</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="bp">cls</span>


<span class="k">def</span> <span class="nf">_instantiate_param_obj</span><span class="p">(</span><span class="n">paramobj</span><span class="p">,</span> <span class="n">owner</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a Parameter object suitable for instantiation given the class&#39;s Parameter object&quot;&quot;&quot;</span>

    <span class="c1"># Shallow-copy Parameter object without the watchers</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">paramobj</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>

    <span class="c1"># Reset watchers since class parameter watcher should not execute</span>
    <span class="c1"># on instance parameters</span>
    <span class="n">p</span><span class="o">.</span><span class="n">watchers</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># shallow-copy any mutable slot values other than the actual default</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_all_slots_</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_is_mutable_container</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">p</span>


<span class="k">def</span> <span class="nf">_instantiated_parameter</span><span class="p">(</span><span class="n">parameterized</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a Parameterized object and one of its class Parameter objects,</span>
<span class="sd">    return the appropriate Parameter object for this instance, instantiating</span>
<span class="sd">    it if need be.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">parameterized</span><span class="o">.</span><span class="n">_param__private</span><span class="p">,</span> <span class="s1">&#39;initialized&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">param</span><span class="o">.</span><span class="n">per_instance</span> <span class="ow">and</span>
        <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">parameterized</span><span class="p">)</span><span class="o">.</span><span class="n">_param__private</span><span class="p">,</span> <span class="s1">&#39;disable_instance_params&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parameterized</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="n">parameterized</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_instantiate_param_obj</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">parameterized</span><span class="p">)</span>

        <span class="n">param</span> <span class="o">=</span> <span class="n">parameterized</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">param</span>


<span class="k">def</span> <span class="nf">instance_descriptor</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="c1"># If parameter has an instance Parameter, delegate setting</span>
    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="c1"># obj is None when the metaclass is setting</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instance_param</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">instance_param</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">instance_param</span> <span class="o">=</span> <span class="n">_instantiated_parameter</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">instance_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">instance_param</span><span class="p">:</span>
                <span class="n">instance_param</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_f</span>


<span class="k">def</span> <span class="nf">get_method_owner</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the instance that owns the supplied method</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">partial</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">func</span>
    <span class="k">return</span> <span class="n">method</span><span class="o">.</span><span class="vm">__self__</span>


<span class="c1"># PARAM3_DEPRECATION</span>
<span class="k">def</span> <span class="nf">recursive_repr</span><span class="p">(</span><span class="n">fillvalue</span><span class="o">=</span><span class="s1">&#39;...&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator to make a repr function return fillvalue for a recursive call</span>

<span class="sd">    .. deprecated:: 1.12.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s1">&#39;recursive_repr has been deprecated and will be removed in a future version.&#39;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="n">_ParamDeprecationWarning</span><span class="p">,</span>
        <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">_recursive_repr</span><span class="p">(</span><span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">)</span>


<div class="viewcode-block" id="output"><a class="viewcode-back" href="../../reference/param/generated/param.output.html#param.output">[docs]</a><span class="nd">@accept_arguments</span>
<span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">output</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    output allows annotating a method on a Parameterized class to</span>
<span class="sd">    declare that it returns an output of a specific type. The outputs</span>
<span class="sd">    of a Parameterized class can be queried using the</span>
<span class="sd">    Parameterized.param.outputs method. By default the output will</span>
<span class="sd">    inherit the method name but a custom name can be declared by</span>
<span class="sd">    expressing the Parameter type using a keyword argument.</span>

<span class="sd">    The simplest declaration simply declares the method returns an</span>
<span class="sd">    object without any type guarantees, e.g.:</span>

<span class="sd">      @output()</span>

<span class="sd">    If a specific parameter type is specified this is a declaration</span>
<span class="sd">    that the method will return a value of that type, e.g.:</span>

<span class="sd">      @output(param.Number())</span>

<span class="sd">    To override the default name of the output the type may be declared</span>
<span class="sd">    as a keyword argument, e.g.:</span>

<span class="sd">      @output(custom_name=param.Number())</span>

<span class="sd">    Multiple outputs may be declared using keywords mapping from output name</span>
<span class="sd">    to the type or using tuples of the same format, i.e. these two declarations</span>
<span class="sd">    are equivalent:</span>

<span class="sd">      @output(number=param.Number(), string=param.String())</span>

<span class="sd">      @output((&#39;number&#39;, param.Number()), (&#39;string&#39;, param.String()))</span>

<span class="sd">    output also accepts Python object types which will be upgraded to</span>
<span class="sd">    a ClassSelector, e.g.:</span>

<span class="sd">      @output(int)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">out</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">out</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">(),</span> <span class="n">i</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">kw</span><span class="p">:</span>
        <span class="c1"># (requires keywords to be kept ordered, which was not true in previous versions)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">i</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">otype</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">())]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)]</span>

    <span class="n">names</span><span class="p">,</span> <span class="n">processed</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">otype</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">otype</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
                <span class="n">otype</span> <span class="o">=</span> <span class="n">otype</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">.import</span> <span class="n">ClassSelector</span>
                <span class="n">otype</span> <span class="o">=</span> <span class="n">ClassSelector</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="n">otype</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">otype</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">otype</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">.import</span> <span class="n">ClassSelector</span>
            <span class="n">otype</span> <span class="o">=</span> <span class="n">ClassSelector</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="n">otype</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">otype</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;output type must be declared with a Parameter class, &#39;</span>
                             <span class="s1">&#39;instance or a Python object type.&#39;</span><span class="p">)</span>
        <span class="n">processed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;When declaring multiple outputs each value &#39;</span>
                         <span class="s1">&#39;must be unique.&#39;</span><span class="p">)</span>

    <span class="n">_dinfo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;_dinfo&#39;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">_dinfo</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;outputs&#39;</span><span class="p">:</span> <span class="n">processed</span><span class="p">})</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_output</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="n">_output</span><span class="o">.</span><span class="n">_dinfo</span> <span class="o">=</span> <span class="n">_dinfo</span>

    <span class="k">return</span> <span class="n">_output</span></div>


<span class="k">def</span> <span class="nf">_parse_dependency_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses param.depends specifications into three components:</span>

<span class="sd">    1. The dotted path to the sub-object</span>
<span class="sd">    2. The attribute being depended on, i.e. either a parameter or method</span>
<span class="sd">    3. The parameter attribute being depended on</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">spec</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;(?P&lt;path&gt;[^:]*):?(?P&lt;what&gt;.*)&quot;</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
    <span class="n">what</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;what&#39;</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?P&lt;obj&gt;.*)(\.)(?P&lt;attr&gt;.*)&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;obj&#39;</span><span class="p">)</span>
    <span class="n">attr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;attr&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">what</span> <span class="ow">or</span> <span class="s1">&#39;value&#39;</span>


<span class="k">def</span> <span class="nf">_params_depended_on</span><span class="p">(</span><span class="n">minfo</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">intermediate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resolves dependencies declared on a Parameterized method.</span>
<span class="sd">    Dynamic dependencies, i.e. dependencies on sub-objects which may</span>
<span class="sd">    or may not yet be available, are only resolved if dynamic=True.</span>
<span class="sd">    By default intermediate dependencies, i.e. dependencies on the</span>
<span class="sd">    path to a sub-object are returned. For example for a dependency</span>
<span class="sd">    on &#39;a.b.c&#39; dependencies on &#39;a&#39; and &#39;b&#39; are returned as long as</span>
<span class="sd">    intermediate=True.</span>

<span class="sd">    Returns lists of concrete dependencies on available parameters</span>
<span class="sd">    and dynamic dependencies specifications which have to resolved</span>
<span class="sd">    if the referenced sub-objects are defined.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">deps</span><span class="p">,</span> <span class="n">dynamic_deps</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">dinfo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">minfo</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;_dinfo&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dependencies&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">minfo</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">param</span><span class="p">)):</span>
        <span class="n">ddeps</span><span class="p">,</span> <span class="n">ddynamic_deps</span> <span class="o">=</span> <span class="p">(</span><span class="n">minfo</span><span class="o">.</span><span class="n">cls</span> <span class="k">if</span> <span class="n">minfo</span><span class="o">.</span><span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">minfo</span><span class="o">.</span><span class="n">inst</span><span class="p">)</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_spec_to_obj</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">,</span> <span class="n">intermediate</span><span class="p">)</span>
        <span class="n">dynamic_deps</span> <span class="o">+=</span> <span class="n">ddynamic_deps</span>
        <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">ddeps</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">PInfo</span><span class="p">):</span>
                <span class="n">deps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">method_deps</span><span class="p">,</span> <span class="n">method_dynamic_deps</span> <span class="o">=</span> <span class="n">_params_depended_on</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">,</span> <span class="n">intermediate</span><span class="p">)</span>
                <span class="n">deps</span> <span class="o">+=</span> <span class="n">method_deps</span>
                <span class="n">dynamic_deps</span> <span class="o">+=</span> <span class="n">method_dynamic_deps</span>
    <span class="k">return</span> <span class="n">deps</span><span class="p">,</span> <span class="n">dynamic_deps</span>


<span class="k">def</span> <span class="nf">_resolve_mcs_deps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">resolved</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">,</span> <span class="n">intermediate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resolves constant and dynamic parameter dependencies previously</span>
<span class="sd">    obtained using the _params_depended_on function. Existing resolved</span>
<span class="sd">    dependencies are updated with a supplied parameter instance while</span>
<span class="sd">    dynamic dependencies are resolved if possible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">resolved</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">dep</span><span class="o">.</span><span class="n">cls</span><span class="p">):</span>
            <span class="n">dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">obj</span> <span class="k">if</span> <span class="n">dep</span><span class="o">.</span><span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dep</span><span class="o">.</span><span class="n">inst</span>
        <span class="n">dep</span> <span class="o">=</span> <span class="n">PInfo</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">inst</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">dep</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">dep</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">pobj</span><span class="o">=</span><span class="n">inst</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">dep</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">what</span><span class="o">=</span><span class="n">dep</span><span class="o">.</span><span class="n">what</span><span class="p">)</span>
        <span class="n">dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">dynamic</span><span class="p">:</span>
        <span class="n">subresolved</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_spec_to_obj</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">intermediate</span><span class="o">=</span><span class="n">intermediate</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subdep</span> <span class="ow">in</span> <span class="n">subresolved</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subdep</span><span class="p">,</span> <span class="n">PInfo</span><span class="p">):</span>
                <span class="n">dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subdep</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dependencies</span> <span class="o">+=</span> <span class="n">_params_depended_on</span><span class="p">(</span><span class="n">subdep</span><span class="p">,</span> <span class="n">intermediate</span><span class="o">=</span><span class="n">intermediate</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dependencies</span>


<span class="k">def</span> <span class="nf">_skip_event</span><span class="p">(</span><span class="o">*</span><span class="n">events</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether a subobject event should be skipped.</span>
<span class="sd">    Returns True if all the values on the new subobject</span>
<span class="sd">    match the values on the previous subobject.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">what</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;what&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;changed&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">changed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">changed</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">what</span> <span class="o">==</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span>
                <span class="n">old</span> <span class="o">=</span> <span class="n">Undefined</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">old</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_getattrr</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">old</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">Undefined</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">new</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_getattrr</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">new</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">old</span> <span class="o">=</span> <span class="n">Undefined</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">old</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_getattrr</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">old</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">what</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">Undefined</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">new</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_getattrr</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">what</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Comparator</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">extract_dependencies</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract references from a method or function that declares the references.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subparameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">_dinfo</span><span class="p">[</span><span class="s1">&#39;dependencies&#39;</span><span class="p">])</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">_dinfo</span><span class="p">[</span><span class="s1">&#39;kw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">subparameters</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">owner</span> <span class="o">=</span> <span class="n">get_method_owner</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
            <span class="o">*</span><span class="n">subps</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">subp</span> <span class="ow">in</span> <span class="n">subps</span><span class="p">:</span>
                <span class="n">owner</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">subp</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">owner</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot depend on undefined sub-parameter </span><span class="si">{p!r}</span><span class="s1">.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">owner</span><span class="o">.</span><span class="n">param</span><span class="p">:</span>
                <span class="n">pobj</span> <span class="o">=</span> <span class="n">owner</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">pobj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pobj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">extract_dependencies</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">p</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">sp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                        <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">params</span>


<span class="c1"># Two callers at the module top level to support pickling.</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">_async_caller</span><span class="p">(</span><span class="o">*</span><span class="n">events</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
        <span class="n">callback</span><span class="p">(</span><span class="o">*</span><span class="n">events</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_skip_event</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">_skip_event</span><span class="p">(</span><span class="o">*</span><span class="n">events</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="n">what</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="n">changed</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">function</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_sync_caller</span><span class="p">(</span><span class="o">*</span><span class="n">events</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
        <span class="n">callback</span><span class="p">(</span><span class="o">*</span><span class="n">events</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_skip_event</span><span class="p">(</span><span class="o">*</span><span class="n">events</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="n">what</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="n">changed</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">function</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_m_caller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps a method call adding support for scheduling a callback</span>
<span class="sd">    before it is executed and skipping events if a subobject has</span>
<span class="sd">    changed but its values have not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span>
    <span class="n">_caller</span> <span class="o">=</span> <span class="n">_async_caller</span> <span class="k">if</span> <span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">function</span><span class="p">)</span> <span class="k">else</span> <span class="n">_sync_caller</span>
    <span class="n">caller</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">_caller</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="n">what</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="n">changed</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">function</span><span class="p">)</span>
    <span class="n">caller</span><span class="o">.</span><span class="n">_watcher_name</span> <span class="o">=</span> <span class="n">method_name</span>
    <span class="k">return</span> <span class="n">caller</span>


<span class="k">def</span> <span class="nf">_add_doc</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">docstring</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a docstring to a namedtuple&quot;&quot;&quot;</span>
    <span class="n">obj</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">docstring</span>


<span class="n">PInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;PInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;inst cls name pobj what&quot;</span><span class="p">)</span>
<span class="n">_add_doc</span><span class="p">(</span><span class="n">PInfo</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object describing something being watched about a Parameter.</span>

<span class="sd">    `inst`: Parameterized instance owning the Parameter, or None</span>

<span class="sd">    `cls`: Parameterized class owning the Parameter</span>

<span class="sd">    `name`: Name of the Parameter being watched</span>

<span class="sd">    `pobj`: Parameter object being watched</span>

<span class="sd">    `what`: What is being watched on the Parameter (either &#39;value&#39; or a slot name)</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">MInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;MInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;inst cls name method&quot;</span><span class="p">)</span>
<span class="n">_add_doc</span><span class="p">(</span><span class="n">MInfo</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object describing a Parameterized method being watched.</span>

<span class="sd">    `inst`: Parameterized instance owning the method, or None</span>

<span class="sd">    `cls`: Parameterized class owning the method</span>

<span class="sd">    `name`: Name of the method being watched</span>

<span class="sd">    `method`: bound method of the object being watched</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">DInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;DInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;spec&quot;</span><span class="p">)</span>
<span class="n">_add_doc</span><span class="p">(</span><span class="n">DInfo</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object describing dynamic dependencies.</span>
<span class="sd">    `spec`: Dependency specification to resolve</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">Event</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="s2">&quot;what name obj cls old new type&quot;</span><span class="p">)</span>
<span class="n">_add_doc</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object representing an event that triggers a Watcher.</span>

<span class="sd">    `what`: What is being watched on the Parameter (either value or a slot name)</span>

<span class="sd">    `name`: Name of the Parameter that was set or triggered</span>

<span class="sd">    `obj`: Parameterized instance owning the watched Parameter, or None</span>

<span class="sd">    `cls`: Parameterized class owning the watched Parameter</span>

<span class="sd">    `old`: Previous value of the item being watched</span>

<span class="sd">    `new`: New value of the item being watched</span>

<span class="sd">    `type`: `triggered` if this event was triggered explicitly), `changed` if</span>
<span class="sd">    the item was set and watching for `onlychanged`, `set` if the item was set,</span>
<span class="sd">    or  None if type not yet known</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">_Watcher</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;Watcher&quot;</span><span class="p">,</span> <span class="s2">&quot;inst cls fn mode onlychanged parameter_names what queued precedence&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Watcher"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Watcher.html#param.Watcher">[docs]</a><span class="k">class</span> <span class="nc">Watcher</span><span class="p">(</span><span class="n">_Watcher</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object declaring a callback function to invoke when an Event is</span>
<span class="sd">    triggered on a watched item.</span>

<span class="sd">    `inst`: Parameterized instance owning the watched Parameter, or</span>
<span class="sd">    None</span>

<span class="sd">    `cls`: Parameterized class owning the watched Parameter</span>

<span class="sd">    `fn`: Callback function to invoke when triggered by a watched</span>
<span class="sd">    Parameter</span>

<span class="sd">    `mode`: &#39;args&#39; for param.watch (call `fn` with PInfo object</span>
<span class="sd">    positional args), or &#39;kwargs&#39; for param.watch_values (call `fn`</span>
<span class="sd">    with &lt;param_name&gt;:&lt;new_value&gt; keywords)</span>

<span class="sd">    `onlychanged`: If True, only trigger for actual changes, not</span>
<span class="sd">    setting to the current value</span>

<span class="sd">    `parameter_names`: List of Parameters to watch, by name</span>

<span class="sd">    `what`: What to watch on the Parameters (either &#39;value&#39; or a slot</span>
<span class="sd">    name)</span>

<span class="sd">    `queued`: Immediately invoke callbacks triggered during processing</span>
<span class="sd">            of an Event (if False), or queue them up for processing</span>
<span class="sd">            later, after this event has been handled (if True)</span>

<span class="sd">    `precedence`: A numeric value which determines the precedence of</span>
<span class="sd">                  the watcher.  Lower precedence values are executed</span>
<span class="sd">                  with higher priority.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">cls_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows creating Watcher without explicit precedence value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cls_</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>
        <span class="n">values</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;precedence&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s1">&#39;precedence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">cls_</span><span class="p">,</span> <span class="o">**</span><span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="si">!r}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_fields</span><span class="p">])</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">attrs</span><span class="si">}</span><span class="s2">)&quot;</span></div>




<span class="k">class</span> <span class="nc">ParameterMetaclass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Metaclass allowing control over creation of Parameter classes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">classdict</span><span class="p">):</span>

        <span class="c1"># store the class&#39;s docstring in __classdoc</span>
        <span class="k">if</span> <span class="s1">&#39;__doc__&#39;</span> <span class="ow">in</span> <span class="n">classdict</span><span class="p">:</span>
            <span class="n">classdict</span><span class="p">[</span><span class="s1">&#39;__classdoc&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">classdict</span><span class="p">[</span><span class="s1">&#39;__doc__&#39;</span><span class="p">]</span>

        <span class="c1"># when asking for help on Parameter *object*, return the doc slot</span>
        <span class="n">classdict</span><span class="p">[</span><span class="s1">&#39;__doc__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">))</span>

        <span class="c1"># Compute all slots in order, using a dict later turned into a list</span>
        <span class="c1"># as it&#39;s the fastest way to get an ordered set in Python</span>
        <span class="n">all_slots</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">bcls</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">))):</span>
            <span class="n">all_slots</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">bcls</span><span class="p">,</span> <span class="s1">&#39;__slots__&#39;</span><span class="p">,</span> <span class="p">[])))</span>

        <span class="c1"># To get the benefit of slots, subclasses must themselves define</span>
        <span class="c1"># __slots__, whether or not they define attributes not present in</span>
        <span class="c1"># the base Parameter class.  That&#39;s because a subclass will have</span>
        <span class="c1"># a __dict__ unless it also defines __slots__.</span>
        <span class="k">if</span> <span class="s1">&#39;__slots__&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">classdict</span><span class="p">:</span>
            <span class="n">classdict</span><span class="p">[</span><span class="s1">&#39;__slots__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_slots</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">classdict</span><span class="p">[</span><span class="s1">&#39;__slots__&#39;</span><span class="p">]))</span>

        <span class="n">classdict</span><span class="p">[</span><span class="s1">&#39;_all_slots_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_slots</span><span class="p">)</span>

        <span class="c1"># No special handling for a __dict__ slot; should there be?</span>
        <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">classdict</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattribute__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">==</span><span class="s1">&#39;__doc__&#39;</span><span class="p">:</span>
            <span class="c1"># when asking for help on Parameter *class*, return the</span>
            <span class="c1"># stored class docstring</span>
            <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="s1">&#39;__classdoc&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_ParameterBase</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ParameterMetaclass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base Parameter class used to dynamically update the signature of all</span>
<span class="sd">    the Parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_modified_slots_defaults</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_slot_defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_label&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">defaults</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># _update_signature has been tested against the Parameters available</span>
        <span class="c1"># in Param, we don&#39;t want to break the Parameters created elsewhere</span>
        <span class="c1"># so wrapping this in a loose try/except.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_update_signature</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># The super signature has been changed so we need to get the one</span>
            <span class="c1"># from the class constructor directly.</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">__signature__</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_update_signature</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_modified_slots_defaults</span><span class="p">()</span>
        <span class="n">new_parameters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kls</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">mro</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">kls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">kls</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pname</span><span class="p">,</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">pname</span> <span class="o">==</span> <span class="s1">&#39;self&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">parameter</span><span class="o">.</span><span class="n">default</span> <span class="o">==</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Signature</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">parameter</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">VAR_KEYWORD</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">VAR_POSITIONAL</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;Argument </span><span class="si">{</span><span class="n">pname</span><span class="si">!r}</span><span class="s1"> of Parameter </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s1"> has no &#39;</span>
                            <span class="s1">&#39;entry in _slot_defaults.&#39;</span>
                        <span class="p">)</span>
                    <span class="n">default</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">default</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="s1">&#39;sig&#39;</span><span class="p">):</span>
                        <span class="n">default</span> <span class="o">=</span> <span class="n">default</span><span class="o">.</span><span class="n">sig</span>
                    <span class="n">new_parameter</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_parameter</span> <span class="o">=</span> <span class="n">parameter</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_parameter</span> <span class="o">=</span> <span class="n">new_parameter</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">KEYWORD_ONLY</span><span class="p">)</span>
                <span class="n">new_parameters</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">pname</span><span class="p">,</span> <span class="n">new_parameter</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_sorter</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">default</span> <span class="o">==</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Signature</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>

        <span class="n">new_parameters</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">new_parameters</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">_sorter</span><span class="p">)</span>
        <span class="n">new_sig</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">new_parameters</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">__signature__</span> <span class="o">=</span> <span class="n">new_sig</span>


<div class="viewcode-block" id="Parameter"><a class="viewcode-back" href="../../reference/param/generated/param.Parameter.html#param.Parameter">[docs]</a><span class="k">class</span> <span class="nc">Parameter</span><span class="p">(</span><span class="n">_ParameterBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An attribute descriptor for declaring parameters.</span>

<span class="sd">    Parameters are a special kind of class attribute.  Setting a</span>
<span class="sd">    Parameterized class attribute to be a Parameter instance causes</span>
<span class="sd">    that attribute of the class (and the class&#39;s instances) to be</span>
<span class="sd">    treated as a Parameter.  This allows special behavior, including</span>
<span class="sd">    dynamically generated parameter values, documentation strings,</span>
<span class="sd">    constant and read-only parameters, and type or range checking at</span>
<span class="sd">    assignment time.</span>

<span class="sd">    For example, suppose someone wants to define two new kinds of</span>
<span class="sd">    objects Foo and Bar, such that Bar has a parameter delta, Foo is a</span>
<span class="sd">    subclass of Bar, and Foo has parameters alpha, sigma, and gamma</span>
<span class="sd">    (and delta inherited from Bar).  She would begin her class</span>
<span class="sd">    definitions with something like this::</span>

<span class="sd">       class Bar(Parameterized):</span>
<span class="sd">           delta = Parameter(default=0.6, doc=&#39;The difference between steps.&#39;)</span>
<span class="sd">           ...</span>
<span class="sd">       class Foo(Bar):</span>
<span class="sd">           alpha = Parameter(default=0.1, doc=&#39;The starting value.&#39;)</span>
<span class="sd">           sigma = Parameter(default=0.5, doc=&#39;The standard deviation.&#39;,</span>
<span class="sd">                           constant=True)</span>
<span class="sd">           gamma = Parameter(default=1.0, doc=&#39;The ending value.&#39;)</span>
<span class="sd">           ...</span>

<span class="sd">    Class Foo would then have four parameters, with delta defaulting</span>
<span class="sd">    to 0.6.</span>

<span class="sd">    Parameters have several advantages over plain attributes:</span>

<span class="sd">    1. Parameters can be set automatically when an instance is</span>
<span class="sd">       constructed: The default constructor for Foo (and Bar) will</span>
<span class="sd">       accept arbitrary keyword arguments, each of which can be used</span>
<span class="sd">       to specify the value of a Parameter of Foo (or any of Foo&#39;s</span>
<span class="sd">       superclasses).  E.g., if a script does this::</span>

<span class="sd">           myfoo = Foo(alpha=0.5)</span>

<span class="sd">       myfoo.alpha will return 0.5, without the Foo constructor</span>
<span class="sd">       needing special code to set alpha.</span>

<span class="sd">       If Foo implements its own constructor, keyword arguments will</span>
<span class="sd">       still be accepted if the constructor accepts a dictionary of</span>
<span class="sd">       keyword arguments (as in ``def __init__(self,**params):``), and</span>
<span class="sd">       then each class calls its superclass (as in</span>
<span class="sd">       ``super(Foo,self).__init__(**params)``) so that the</span>
<span class="sd">       Parameterized constructor will process the keywords.</span>

<span class="sd">    2. A Parameterized class need specify only the attributes of a</span>
<span class="sd">       Parameter whose values differ from those declared in</span>
<span class="sd">       superclasses; the other values will be inherited.  E.g. if Foo</span>
<span class="sd">       declares::</span>

<span class="sd">        delta = Parameter(default=0.2)</span>

<span class="sd">       the default value of 0.2 will override the 0.6 inherited from</span>
<span class="sd">       Bar, but the doc will be inherited from Bar.</span>

<span class="sd">    3. The Parameter descriptor class can be subclassed to provide</span>
<span class="sd">       more complex behavior, allowing special types of parameters</span>
<span class="sd">       that, for example, require their values to be numbers in</span>
<span class="sd">       certain ranges, generate their values dynamically from a random</span>
<span class="sd">       distribution, or read their values from a file or other</span>
<span class="sd">       external source.</span>

<span class="sd">    4. The attributes associated with Parameters provide enough</span>
<span class="sd">       information for automatically generating property sheets in</span>
<span class="sd">       graphical user interfaces, allowing Parameterized instances to</span>
<span class="sd">       be edited by users.</span>

<span class="sd">    Note that Parameters can only be used when set as class attributes</span>
<span class="sd">    of Parameterized classes. Parameters used as standalone objects,</span>
<span class="sd">    or as class attributes of non-Parameterized classes, will not have</span>
<span class="sd">    the behavior described here.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Because they implement __get__ and __set__, Parameters are known</span>
    <span class="c1"># as &#39;descriptors&#39; in Python; see &quot;Implementing Descriptors&quot; and</span>
    <span class="c1"># &quot;Invoking Descriptors&quot; in the &#39;Customizing attribute access&#39;</span>
    <span class="c1"># section of the Python reference manual:</span>
    <span class="c1"># http://docs.python.org/ref/attribute-access.html</span>
    <span class="c1">#</span>
    <span class="c1"># Overview of Parameters for programmers</span>
    <span class="c1"># ======================================</span>
    <span class="c1">#</span>
    <span class="c1"># Consider the following code:</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># class A(Parameterized):</span>
    <span class="c1">#     p = Parameter(default=1)</span>
    <span class="c1">#</span>
    <span class="c1"># a1 = A()</span>
    <span class="c1"># a2 = A()</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># * a1 and a2 share one Parameter object (A.__dict__[&#39;p&#39;]).</span>
    <span class="c1">#</span>
    <span class="c1"># * The default (class) value of p is stored in this Parameter</span>
    <span class="c1">#   object (A.__dict__[&#39;p&#39;].default).</span>
    <span class="c1">#</span>
    <span class="c1"># * If the value of p is set on a1 (e.g. a1.p=2), a1&#39;s value of p</span>
    <span class="c1">#   is stored in a1 itself (a1._param__private.values[&#39;p&#39;])</span>
    <span class="c1">#</span>
    <span class="c1"># * When a1.p is requested, a1._param__private.values[&#39;p&#39;] is</span>
    <span class="c1">#   returned. When a2.p is requested, &#39;p&#39; is not found in</span>
    <span class="c1">#   a1._param__private.values, so A.__dict__[&#39;p&#39;].default (i.e. A.p) is</span>
    <span class="c1">#   returned instead.</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># Be careful when referring to the &#39;name&#39; of a Parameter:</span>
    <span class="c1">#</span>
    <span class="c1"># * A Parameterized class has a name for the attribute which is</span>
    <span class="c1">#   being represented by the Parameter (&#39;p&#39; in the example above);</span>
    <span class="c1">#   in the code, this is called the &#39;name&#39;.</span>
    <span class="c1">#</span>
    <span class="c1"># * When a Parameterized instance has its own local value for a</span>
    <span class="c1">#   parameter, it is stored as &#39;p._param__private.values[X]&#39; where X is the</span>
    <span class="c1">#   name of the Parameter</span>


    <span class="c1"># So that the extra features of Parameters do not require a lot of</span>
    <span class="c1"># overhead, Parameters are implemented using __slots__ (see</span>
    <span class="c1"># http://www.python.org/doc/2.4/ref/slots.html).  Instead of having</span>
    <span class="c1"># a full Python dictionary associated with each Parameter instance,</span>
    <span class="c1"># Parameter instances have an enumerated list (named __slots__) of</span>
    <span class="c1"># attributes, and reserve just enough space to store these</span>
    <span class="c1"># attributes.  Using __slots__ requires special support for</span>
    <span class="c1"># operations to copy and restore Parameters (e.g. for Python</span>
    <span class="c1"># persistent storage pickling); see __getstate__ and __setstate__.</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;doc&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;precedence&#39;</span><span class="p">,</span> <span class="s1">&#39;instantiate&#39;</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="s1">&#39;readonly&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;pickle_default_value&#39;</span><span class="p">,</span> <span class="s1">&#39;allow_None&#39;</span><span class="p">,</span> <span class="s1">&#39;per_instance&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;watchers&#39;</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="s1">&#39;allow_refs&#39;</span><span class="p">,</span> <span class="s1">&#39;nested_refs&#39;</span><span class="p">,</span> <span class="s1">&#39;_label&#39;</span><span class="p">]</span>

    <span class="c1"># Note: When initially created, a Parameter does not know which</span>
    <span class="c1"># Parameterized class owns it, nor does it know its names</span>
    <span class="c1"># (attribute name, internal name). Once the owning Parameterized</span>
    <span class="c1"># class is created, owner, and name are</span>
    <span class="c1"># set.</span>

    <span class="n">_serializers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;json&#39;</span><span class="p">:</span> <span class="n">serializer</span><span class="o">.</span><span class="n">JSONSerialization</span><span class="p">}</span>

    <span class="n">_slot_defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instantiate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">constant</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pickle_default_value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">per_instance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_refs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nested_refs</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="c1"># Parameters can be updated during Parameterized class creation when they</span>
    <span class="c1"># are defined multiple times in a class hierarchy. We have to record which</span>
    <span class="c1"># Parameter slots require the default value to be re-validated. Any slots</span>
    <span class="c1"># in this list do not have to trigger such re-validation.</span>
    <span class="n">_non_validated_slots</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_label&#39;</span><span class="p">,</span> <span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;precedence&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="s1">&#39;pickle_default_value&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;watchers&#39;</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">]</span>

    <span class="nd">@typing</span><span class="o">.</span><span class="n">overload</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instantiate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pickle_default_value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">per_instance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">allow_refs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nested_refs</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="o">...</span>

<div class="viewcode-block" id="Parameter.__init__"><a class="viewcode-back" href="../../reference/param/generated/param.Parameter.html#param.Parameter.__init__">[docs]</a>    <span class="nd">@_deprecate_positional_args</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="c1"># pylint: disable-msg=R0913</span>
                 <span class="n">label</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                 <span class="n">instantiate</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                 <span class="n">pickle_default_value</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span>
                 <span class="n">per_instance</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">allow_refs</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">nested_refs</span><span class="o">=</span><span class="n">Undefined</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a new Parameter object and store the supplied attributes:</span>

<span class="sd">        default: the owning class&#39;s value for the attribute represented</span>
<span class="sd">        by this Parameter, which can be overridden in an instance.</span>

<span class="sd">        doc: docstring explaining what this parameter represents.</span>

<span class="sd">        label: optional text label to be used when this Parameter is</span>
<span class="sd">        shown in a listing. If no label is supplied, the attribute name</span>
<span class="sd">        for this parameter in the owning Parameterized object is used.</span>

<span class="sd">        precedence: a numeric value, usually in the range 0.0 to 1.0,</span>
<span class="sd">        which allows the order of Parameters in a class to be defined in</span>
<span class="sd">        a listing or e.g. in GUI menus. A negative precedence indicates</span>
<span class="sd">        a parameter that should be hidden in such listings.</span>

<span class="sd">        instantiate: controls whether the value of this Parameter will</span>
<span class="sd">        be deepcopied when a Parameterized object is instantiated (if</span>
<span class="sd">        True), or if the single default value will be shared by all</span>
<span class="sd">        Parameterized instances (if False). For an immutable Parameter</span>
<span class="sd">        value, it is best to leave instantiate at the default of</span>
<span class="sd">        False, so that a user can choose to change the value at the</span>
<span class="sd">        Parameterized instance level (affecting only that instance) or</span>
<span class="sd">        at the Parameterized class or superclass level (affecting all</span>
<span class="sd">        existing and future instances of that class or superclass). For</span>
<span class="sd">        a mutable Parameter value, the default of False is also appropriate</span>
<span class="sd">        if you want all instances to share the same value state, e.g. if</span>
<span class="sd">        they are each simply referring to a single global object like</span>
<span class="sd">        a singleton. If instead each Parameterized should have its own</span>
<span class="sd">        independently mutable value, instantiate should be set to</span>
<span class="sd">        True, but note that there is then no simple way to change the</span>
<span class="sd">        value of this Parameter at the class or superclass level,</span>
<span class="sd">        because each instance, once created, will then have an</span>
<span class="sd">        independently instantiated value.</span>

<span class="sd">        constant: if true, the Parameter value can be changed only at</span>
<span class="sd">        the class level or in a Parameterized constructor call. The</span>
<span class="sd">        value is otherwise constant on the Parameterized instance,</span>
<span class="sd">        once it has been constructed.</span>

<span class="sd">        readonly: if true, the Parameter value cannot ordinarily be</span>
<span class="sd">        changed by setting the attribute at the class or instance</span>
<span class="sd">        levels at all. The value can still be changed in code by</span>
<span class="sd">        temporarily overriding the value of this slot and then</span>
<span class="sd">        restoring it, which is useful for reporting values that the</span>
<span class="sd">        _user_ should never change but which do change during code</span>
<span class="sd">        execution.</span>

<span class="sd">        pickle_default_value: whether the default value should be</span>
<span class="sd">        pickled. Usually, you would want the default value to be pickled,</span>
<span class="sd">        but there are rare cases where that would not be the case (e.g.</span>
<span class="sd">        for file search paths that are specific to a certain system).</span>

<span class="sd">        per_instance: whether a separate Parameter instance will be</span>
<span class="sd">        created for every Parameterized instance. True by default.</span>
<span class="sd">        If False, all instances of a Parameterized class will share</span>
<span class="sd">        the same Parameter object, including all validation</span>
<span class="sd">        attributes (bounds, etc.). See also instantiate, which is</span>
<span class="sd">        conceptually similar but affects the Parameter value rather</span>
<span class="sd">        than the Parameter object.</span>

<span class="sd">        allow_None: if True, None is accepted as a valid value for</span>
<span class="sd">        this Parameter, in addition to any other values that are</span>
<span class="sd">        allowed. If the default value is defined as None, allow_None</span>
<span class="sd">        is set to True automatically.</span>

<span class="sd">        allow_refs: if True allows automatically linking parameter</span>
<span class="sd">        references to this Parameter, i.e. the parameter value will</span>
<span class="sd">        automatically reflect the current value of the reference that</span>
<span class="sd">        is passed in.</span>

<span class="sd">        nested_refs: if True and allow_refs=True then even nested objects</span>
<span class="sd">        such as dictionaries, lists, slices, tuples and sets will be</span>
<span class="sd">        inspected for references and will be automatically resolved.</span>

<span class="sd">        default, doc, and precedence all default to None, which allows</span>
<span class="sd">        inheritance of Parameter slots (attributes) from the owning-class&#39;</span>
<span class="sd">        class hierarchy (see ParameterizedMetaclass).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_refs</span> <span class="o">=</span> <span class="n">allow_refs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nested_refs</span> <span class="o">=</span> <span class="n">nested_refs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precedence</span> <span class="o">=</span> <span class="n">precedence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">doc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="n">constant</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">readonly</span> <span class="ow">is</span> <span class="kc">True</span> <span class="c1"># readonly =&gt; constant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span> <span class="o">=</span> <span class="n">readonly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_instantiate</span><span class="p">(</span><span class="n">instantiate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pickle_default_value</span> <span class="o">=</span> <span class="n">pickle_default_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_allow_None</span><span class="p">(</span><span class="n">allow_None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">watchers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">per_instance</span> <span class="o">=</span> <span class="n">per_instance</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="s2">&quot;Given the parameter value, return a Python value suitable for serialization&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="s2">&quot;Given a serializable Python value, return a value that the parameter can be set to&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">serializer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;Cannot import serializer.py needed to generate schema&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_serializers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">mode</span><span class="si">!r}</span><span class="s1"> not in available serialization formats </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_serializers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serializers</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span><span class="o">.</span><span class="n">param_schema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
                                                    <span class="n">safe</span><span class="o">=</span><span class="n">safe</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.reactive</span> <span class="kn">import</span> <span class="n">reactive_ops</span>
        <span class="k">return</span> <span class="n">reactive_ops</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">label_formatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span>

    <span class="nd">@label</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_set_allow_None</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow_None</span><span class="p">):</span>
        <span class="c1"># allow_None is set following these rules (last takes precedence):</span>
        <span class="c1"># 1. to False by default</span>
        <span class="c1"># 2. to the value provided in the constructor, if any</span>
        <span class="c1"># 3. to True if default is None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">allow_None</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span> <span class="o">=</span> <span class="n">allow_None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slot_defaults</span><span class="p">[</span><span class="s1">&#39;allow_None&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_set_instantiate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">instantiate</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constant parameters must be instantiated.&quot;&quot;&quot;</span>
        <span class="c1"># instantiate doesn&#39;t actually matter for read-only</span>
        <span class="c1"># parameters, since they can&#39;t be set even on a class.  But</span>
        <span class="c1"># having this code avoids needless instantiation.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instantiate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">instantiate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instantiate</span> <span class="o">=</span> <span class="n">instantiate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Default value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instantiate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slot_defaults</span><span class="p">[</span><span class="s1">&#39;instantiate&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Parameter name cannot be modified after &quot;</span>
                                     <span class="s2">&quot;it has been bound to a Parameterized.&quot;</span><span class="p">)</span>

        <span class="n">is_slot</span> <span class="o">=</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_all_slots_</span>
        <span class="n">has_watcher</span> <span class="o">=</span> <span class="n">attribute</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span> <span class="ow">and</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;watchers&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">is_slot</span> <span class="ow">or</span> <span class="n">has_watcher</span><span class="p">):</span>
            <span class="c1"># Return early if attribute is not a slot</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># Otherwise get the old value so we can call watcher/on_set</span>
        <span class="n">old</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="bp">NotImplemented</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_slot</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_on_set</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">has_watcher</span> <span class="ow">and</span> <span class="n">old</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">NotImplemented</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_event</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_trigger_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="n">attribute</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span>
                      <span class="n">old</span><span class="o">=</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="n">new</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">watcher</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">watchers</span><span class="p">[</span><span class="n">attribute</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_call_watcher</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_batch_call_watchers</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allow slot values to be Undefined in an &quot;unbound&quot; parameter, i.e. one</span>
<span class="sd">        that is not (yet) owned by a Parameterized object, in which case their</span>
<span class="sd">        value will be retrieved from the _slot_defaults dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="c1"># Safely checks for name (avoiding recursion) to decide if this object is unbound</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="n">Undefined</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;name&quot;</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slot_defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Slot </span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s1"> on unbound parameter </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s1"> &#39;</span>
                    <span class="s1">&#39;has no default value defined in `_slot_defaults`&#39;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">_on_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Can be overridden on subclasses to handle changes when parameter</span>
<span class="sd">        attribute is set.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Can be overridden on subclasses to update a Parameter state, i.e. slot</span>
<span class="sd">        values, after the slot values have been set in the inheritance procedure.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">objtype</span><span class="p">):</span> <span class="c1"># pylint: disable-msg=W0613</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the value for this Parameter.</span>

<span class="sd">        If called for a Parameterized class, produce that</span>
<span class="sd">        class&#39;s value (i.e. this Parameter object&#39;s &#39;default&#39;</span>
<span class="sd">        attribute).</span>

<span class="sd">        If called for a Parameterized instance, produce that</span>
<span class="sd">        instance&#39;s value, if one has been set - otherwise produce the</span>
<span class="sd">        class&#39;s value (default).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># e.g. when __get__ called for a Parameterized class</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Attribute error when .values does not exist (_ClassPrivate)</span>
            <span class="c1"># and KeyError when there&#39;s no cached value for this parameter.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@instance_descriptor</span>
    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the value for this Parameter.</span>

<span class="sd">        If called for a Parameterized class, set that class&#39;s</span>
<span class="sd">        value (i.e. set this Parameter object&#39;s &#39;default&#39; attribute).</span>

<span class="sd">        If called for a Parameterized instance, set the value of</span>
<span class="sd">        this Parameter on that instance (i.e. in the instance&#39;s</span>
<span class="sd">        `values` dictionary located in the private namespace `_param__private`,</span>
<span class="sd">        under the parameter&#39;s name).</span>

<span class="sd">        If the Parameter&#39;s constant attribute is True, only allows</span>
<span class="sd">        the value to be set for a Parameterized class or on</span>
<span class="sd">        uninitialized Parameterized instances.</span>

<span class="sd">        If the Parameter&#39;s readonly attribute is True, only allows the</span>
<span class="sd">        value to be specified in the Parameter declaration inside the</span>
<span class="sd">        Parameterized source code. A read-only parameter also</span>
<span class="sd">        cannot be set on a Parameterized class.</span>

<span class="sd">        Note that until we support some form of read-only</span>
<span class="sd">        object, it is still possible to change the attributes of the</span>
<span class="sd">        object stored in a constant or read-only Parameter (e.g. one</span>
<span class="sd">        item in a list).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_refs</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">initialized</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">syncing</span><span class="p">:</span>
            <span class="n">ref</span><span class="p">,</span> <span class="n">deps</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">is_async</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_resolve_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="n">refs</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">refs</span>
            <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_update_ref</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">refs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">async_refs</span><span class="p">:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">async_refs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">is_async</span> <span class="ow">or</span> <span class="n">val</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="c1"># Deprecated Number set_hook called here to avoid duplicating setter</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;set_hook&#39;</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_hook</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_hook</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_identity_hook</span><span class="p">:</span>
                <span class="c1"># PARAM3_DEPRECATION</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s1">&#39;Number.set_hook has been deprecated.&#39;</span><span class="p">,</span>
                    <span class="n">category</span><span class="o">=</span><span class="n">_ParamDeprecationWarning</span><span class="p">,</span>
                    <span class="n">stacklevel</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="n">_old</span> <span class="o">=</span> <span class="bp">NotImplemented</span>
        <span class="c1"># obj can be None if __set__ is called for a Parameterized class</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Read-only parameter &#39;</span><span class="si">%s</span><span class="s2">&#39; cannot be modified&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">initialized</span><span class="p">:</span>
                <span class="n">_old</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_old</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_old</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Constant parameter &#39;</span><span class="si">%s</span><span class="s2">&#39; cannot be modified&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># When setting a Parameter before calling super.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="p">,</span> <span class="n">_InstancePrivate</span><span class="p">):</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span> <span class="o">=</span> <span class="n">_InstancePrivate</span><span class="p">(</span>
                        <span class="n">explicit_no_refs</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">explicit_no_refs</span>
                    <span class="p">)</span>
                <span class="n">_old</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post_setter</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_param__private&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="p">,</span> <span class="s1">&#39;initialized&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_update_deps</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">watchers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">watchers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">watchers</span><span class="p">:</span>
            <span class="n">watchers</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">watchers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">watchers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">watchers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">watchers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">watchers</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">obj</span>

        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">watchers</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span>
                      <span class="n">old</span><span class="o">=</span><span class="n">_old</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Copy watchers here since they may be modified inplace during iteration</span>
        <span class="k">for</span> <span class="n">watcher</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">watchers</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">precedence</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_call_watcher</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_BATCH_WATCH</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_batch_call_watchers</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_validate_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">allow_None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implements validation for parameter value&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implements validation for the parameter value and attributes&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_value</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_post_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called after the parameter value has been validated and set&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Cannot delete &#39;</span><span class="si">%s</span><span class="s2">&#39;: Parameters deletion not allowed.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">attrib_name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;The </span><span class="si">{}</span><span class="s1"> parameter </span><span class="si">{!r}</span><span class="s1"> has already been &#39;</span>
                                 <span class="s1">&#39;assigned a name by the </span><span class="si">{}</span><span class="s1"> class, &#39;</span>
                                 <span class="s1">&#39;could not assign new name </span><span class="si">{!r}</span><span class="s1">. Parameters &#39;</span>
                                 <span class="s1">&#39;may not be shared by multiple classes; &#39;</span>
                                 <span class="s1">&#39;ensure that you create a new parameter &#39;</span>
                                 <span class="s1">&#39;instance for each new class.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">attrib_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">attrib_name</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        All Parameters have slots, not a dict, so we have to support</span>
<span class="sd">        pickle and deepcopy ourselves.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">slot</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span> <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_all_slots_</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="p">):</span>
        <span class="c1"># set values of __slots__ (instead of in non-existent __dict__)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></div>


<span class="c1"># Define one particular type of Parameter that is used in this file</span>
<div class="viewcode-block" id="String"><a class="viewcode-back" href="../../reference/param/generated/param.String.html#param.String">[docs]</a><span class="k">class</span> <span class="nc">String</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A String Parameter, with a default value and optional regular expression (regex) matching.</span>

<span class="sd">    Example of using a regex to implement IPv4 address matching::</span>

<span class="sd">      class IPAddress(String):</span>
<span class="sd">        &#39;&#39;&#39;IPv4 address as a string (dotted decimal notation)&#39;&#39;&#39;</span>
<span class="sd">       def __init__(self, default=&quot;0.0.0.0&quot;, allow_None=False, **kwargs):</span>
<span class="sd">           ip_regex = r&#39;^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$&#39;</span>
<span class="sd">           super(IPAddress, self).__init__(default=default, regex=ip_regex, **kwargs)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;regex&#39;</span><span class="p">]</span>

    <span class="n">_slot_defaults</span> <span class="o">=</span> <span class="n">_dict_update</span><span class="p">(</span><span class="n">Parameter</span><span class="o">.</span><span class="n">_slot_defaults</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="nd">@typing</span><span class="o">.</span><span class="n">overload</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instantiate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pickle_default_value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">per_instance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">allow_refs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nested_refs</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="o">...</span>

<div class="viewcode-block" id="String.__init__"><a class="viewcode-back" href="../../reference/param/generated/param.String.html#param.String.__init__">[docs]</a>    <span class="nd">@_deprecate_positional_args</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regex</span> <span class="o">=</span> <span class="n">regex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_validate_regex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">regex</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">regex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_validate_error_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1"> value </span><span class="si">{</span><span class="n">val</span><span class="si">!r}</span><span class="s1"> does not &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;match regex </span><span class="si">{</span><span class="n">regex</span><span class="si">!r}</span><span class="s1">.&#39;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">allow_None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">allow_None</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_validate_error_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1"> only takes a string value, &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;not value of </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_value</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_regex</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">shared_parameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Context manager to share parameter instances when creating</span>
<span class="sd">    multiple Parameterized objects of the same type. Parameter default</span>
<span class="sd">    values are instantiated once and cached to be reused when another</span>
<span class="sd">    Parameterized object of the same type is instantiated.</span>
<span class="sd">    Can be useful to easily modify large collections of Parameterized</span>
<span class="sd">    objects at once and can provide a significant speedup.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_share</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_shared_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_share</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_share</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_shared_cache</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">as_uninitialized</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator: call fn with the parameterized_instance&#39;s</span>
<span class="sd">    initialization flag set to False, then revert the flag.</span>

<span class="sd">    (Used to decorate Parameterized methods that must alter</span>
<span class="sd">    a constant Parameter.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">override_initialization</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">parameterized_instance</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>
        <span class="n">original_initialized</span> <span class="o">=</span> <span class="n">parameterized_instance</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">initialized</span>
        <span class="n">parameterized_instance</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">parameterized_instance</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="n">original_initialized</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">return</span> <span class="n">override_initialization</span>


<span class="k">class</span> <span class="nc">Comparator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comparator defines methods for determining whether two objects</span>
<span class="sd">    should be considered equal. It works by registering custom</span>
<span class="sd">    comparison functions, which may either be registed by type or with</span>
<span class="sd">    a predicate function. If no matching comparison can be found for</span>
<span class="sd">    the two objects the comparison will return False.</span>

<span class="sd">    If registered by type the Comparator will check whether both</span>
<span class="sd">    objects are of that type and apply the comparison. If the equality</span>
<span class="sd">    function is instead registered with a function it will call the</span>
<span class="sd">    function with each object individually to check if the comparison</span>
<span class="sd">    applies. This is useful for defining comparisons for objects</span>
<span class="sd">    without explicitly importing them.</span>

<span class="sd">    To use the Comparator simply call the is_equal function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">equalities</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>
        <span class="nb">bytes</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>
        <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s1">&#39;_infinitely_iterable&#39;</span><span class="p">):</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>  <span class="c1"># Time</span>
    <span class="p">}</span>
    <span class="n">equalities</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">dtt</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span> <span class="k">for</span> <span class="n">dtt</span> <span class="ow">in</span> <span class="n">dt_types</span><span class="p">})</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_equal</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">eq_type</span><span class="p">,</span> <span class="n">eq</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">equalities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">are_instances</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">eq_type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj2</span><span class="p">,</span> <span class="n">eq_type</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">are_instances</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">eq</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq_type</span><span class="p">,</span> <span class="n">FunctionType</span><span class="p">)</span> <span class="ow">and</span> <span class="n">eq_type</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">eq_type</span><span class="p">(</span><span class="n">obj2</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">eq</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj2</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">compare_iterator</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj2</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">compare_mapping</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">compare_iterator</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj2</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">compare_mapping</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj2</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj2</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj2</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="n">obj1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">obj2</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>


<span class="k">class</span> <span class="nc">_ParametersRestorer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Context-manager to handle the reset of parameter values after an update.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">restore</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restore</span> <span class="o">=</span> <span class="n">restore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">refs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">refs</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_restore</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_refs</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">class</span> <span class="nc">Parameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Object that holds the namespace and implementation of Parameterized</span>
<span class="sd">    methods as well as any state that is not in __slots__ or the</span>
<span class="sd">    Parameters themselves.</span>

<span class="sd">    Exists at both the metaclass level (instantiated by the metaclass)</span>
<span class="sd">    and at the instance level. Can contain state specific to either the</span>
<span class="sd">    class or the instance as necessary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        cls is the Parameterized class which is always set.</span>
<span class="sd">        self is the instance if set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="bp">cls</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_BATCH_WATCH</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">parameters_state</span><span class="p">[</span><span class="s1">&#39;BATCH_WATCH&#39;</span><span class="p">]</span>

    <span class="nd">@_BATCH_WATCH</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_BATCH_WATCH</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">parameters_state</span><span class="p">[</span><span class="s1">&#39;BATCH_WATCH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_TRIGGER</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">parameters_state</span><span class="p">[</span><span class="s1">&#39;TRIGGER&#39;</span><span class="p">]</span>

    <span class="nd">@_TRIGGER</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_TRIGGER</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">parameters_state</span><span class="p">[</span><span class="s1">&#39;TRIGGER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_events</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">parameters_state</span><span class="p">[</span><span class="s1">&#39;events&#39;</span><span class="p">]</span>

    <span class="nd">@_events</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_events</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">parameters_state</span><span class="p">[</span><span class="s1">&#39;events&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_state_watchers</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">parameters_state</span><span class="p">[</span><span class="s1">&#39;watchers&#39;</span><span class="p">]</span>

    <span class="nd">@_state_watchers</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_state_watchers</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">parameters_state</span><span class="p">[</span><span class="s1">&#39;watchers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">watchers</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dictionary of instance watchers.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Accessing `.param.watchers` is only supported on a Parameterized instance, not class.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">watchers</span>

    <span class="nd">@watchers</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">watchers</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Setting `.param.watchers` is only supported on a Parameterized instance, not class.&#39;</span><span class="p">)</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">watchers</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">self_or_cls</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span> <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="c1"># Set old parameters state on Parameterized.parameters_state</span>
        <span class="n">self_</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;self&#39;</span><span class="p">),</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cls&#39;</span><span class="p">)</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span> <span class="k">if</span> <span class="n">self_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">cls</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">parameters_state</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">k</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">parameters_state</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the class or instance parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>
        <span class="k">if</span> <span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">_cls_parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">_instantiated_parameter</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds parameters to dir</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">_cls_parameters</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates over the parameters on this object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield from</span> <span class="n">self_</span><span class="o">.</span><span class="n">_cls_parameters</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">self_</span><span class="o">.</span><span class="n">_cls_parameters</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extends attribute access to parameter objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cls&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># Class not initialized</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span>

        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">self_</span><span class="o">.</span><span class="n">_cls_parameters</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;type object &#39;</span><span class="si">{</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.param&#39; has no attribute </span><span class="si">{</span><span class="n">attr</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.param&#39; object has no attribute </span><span class="si">{</span><span class="n">attr</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@as_uninitialized</span>
    <span class="k">def</span> <span class="nf">_set_name</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="nd">@as_uninitialized</span>
    <span class="k">def</span> <span class="nf">_generate_name</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">_set_name</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%05d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">object_count</span><span class="p">))</span>

    <span class="nd">@as_uninitialized</span>
    <span class="k">def</span> <span class="nf">_setup_params</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize default and keyword parameter values.</span>

<span class="sd">        First, ensures that values for all Parameters with &#39;instantiate=True&#39;</span>
<span class="sd">        (typically used for mutable Parameters) are copied directly into each object,</span>
<span class="sd">        to ensure that there is an independent copy of the value (to avoid surprising</span>
<span class="sd">        aliasing errors). Second, ensures that Parameters with &#39;constant=True&#39; are</span>
<span class="sd">        referenced on the instance, to make sure that setting a constant</span>
<span class="sd">        Parameter on the class doesn&#39;t affect already created instances. Then</span>
<span class="sd">        sets each of the keyword arguments, raising when any of them are not</span>
<span class="sd">        defined as parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>
        <span class="c1">## Deepcopy all &#39;instantiate=True&#39; parameters</span>
        <span class="n">params_to_deepcopy</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">params_to_ref</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">objects</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_cls_parameters</span>
        <span class="k">for</span> <span class="n">pname</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">objects</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">instantiate</span> <span class="ow">and</span> <span class="n">pname</span> <span class="o">!=</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                <span class="n">params_to_deepcopy</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">constant</span> <span class="ow">and</span> <span class="n">pname</span> <span class="o">!=</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span>
                <span class="n">params_to_ref</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params_to_deepcopy</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">_instantiate_param</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params_to_ref</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">_instantiate_param</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">deepcopy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1">## keyword arg setting</span>
        <span class="n">deps</span><span class="p">,</span> <span class="n">refs</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">get_param_descriptor</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># pylint: disable-msg=E1101</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">desc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.__init__() got an unexpected &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;keyword argument </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">pobj</span> <span class="o">=</span> <span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pobj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">pobj</span><span class="o">.</span><span class="n">allow_refs</span><span class="p">:</span>
                <span class="c1"># Until Parameter.allow_refs=True by default we have to</span>
                <span class="c1"># speculatively evaluate a values to check whether they</span>
                <span class="c1"># contain a reference and warn the user that the</span>
                <span class="c1"># behavior may change in future.</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">explicit_no_refs</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ref</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">resolved</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_resolve_ref</span><span class="p">(</span><span class="n">pobj</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">ref</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">ref</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Parameter </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2"> on </span><span class="si">{</span><span class="n">pobj</span><span class="o">.</span><span class="n">owner</span><span class="si">}</span><span class="s2"> is being given a valid parameter &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;reference </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2"> but is implicitly allow_refs=False. &quot;</span>
                            <span class="s2">&quot;In future allow_refs will be enabled by default and &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;the reference </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2"> will be resolved to its underlying &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;value </span><span class="si">{</span><span class="n">resolved</span><span class="si">}</span><span class="s2">. Please explicitly set allow_ref on the &quot;</span>
                            <span class="s2">&quot;Parameter definition to declare whether references &quot;</span>
                            <span class="s2">&quot;should be resolved or not.&quot;</span><span class="p">,</span>
                            <span class="n">category</span><span class="o">=</span><span class="n">_ParamFutureWarning</span><span class="p">,</span>
                            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Resolve references</span>
            <span class="n">ref</span><span class="p">,</span> <span class="n">ref_deps</span><span class="p">,</span> <span class="n">resolved</span><span class="p">,</span> <span class="n">is_async</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_resolve_ref</span><span class="p">(</span><span class="n">pobj</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">refs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span>
                <span class="n">deps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_deps</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_async</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">resolved</span> <span class="ow">is</span> <span class="n">Undefined</span> <span class="ow">or</span> <span class="n">resolved</span> <span class="ow">is</span> <span class="n">Skip</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">resolved</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">refs</span><span class="p">,</span> <span class="n">deps</span>

    <span class="k">def</span> <span class="nf">_setup_refs</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">refs</span><span class="p">):</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pname</span><span class="p">,</span> <span class="n">subrefs</span> <span class="ow">in</span> <span class="n">refs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">subrefs</span><span class="p">:</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
                    <span class="n">groups</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">owner</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pname</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">extract_dependencies</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                        <span class="n">groups</span><span class="p">[</span><span class="n">sp</span><span class="o">.</span><span class="n">owner</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pname</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">owner</span><span class="p">,</span> <span class="n">pnames</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">refnames</span><span class="p">,</span> <span class="n">pnames</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">pnames</span><span class="p">)</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">ref_watchers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
                <span class="n">refnames</span><span class="p">,</span>
                <span class="n">owner</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_watch</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">_sync_refs</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pnames</span><span class="p">)),</span> <span class="n">precedence</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">))</span>

    <span class="k">def</span> <span class="nf">_update_ref</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span>
        <span class="n">param_private</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">param_private</span><span class="o">.</span><span class="n">async_refs</span><span class="p">:</span>
            <span class="n">param_private</span><span class="o">.</span><span class="n">async_refs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">watcher</span> <span class="ow">in</span> <span class="n">param_private</span><span class="o">.</span><span class="n">ref_watchers</span><span class="p">:</span>
            <span class="n">dep_obj</span> <span class="o">=</span> <span class="n">watcher</span><span class="o">.</span><span class="n">cls</span> <span class="k">if</span> <span class="n">watcher</span><span class="o">.</span><span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">watcher</span><span class="o">.</span><span class="n">inst</span>
            <span class="n">dep_obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">unwatch</span><span class="p">(</span><span class="n">watcher</span><span class="p">)</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">ref_watchers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">refs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">refs</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">ref</span><span class="p">})</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">resolve_ref</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">refs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">_setup_refs</span><span class="p">(</span><span class="n">deps</span><span class="p">)</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">refs</span> <span class="o">=</span> <span class="n">refs</span>

    <span class="k">def</span> <span class="nf">_sync_refs</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">events</span><span class="p">):</span>
        <span class="n">updates</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pname</span><span class="p">,</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">refs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Skip updating value if dependency has not changed</span>
            <span class="n">recursive</span> <span class="o">=</span> <span class="n">self_</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span><span class="o">.</span><span class="n">nested_refs</span>
            <span class="n">deps</span> <span class="o">=</span> <span class="n">resolve_ref</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">recursive</span><span class="p">)</span>
            <span class="n">is_gen</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isgeneratorfunction</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
            <span class="n">is_async</span> <span class="o">=</span> <span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_gen</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">((</span><span class="n">dep</span><span class="o">.</span><span class="n">owner</span> <span class="ow">is</span> <span class="n">e</span><span class="o">.</span><span class="n">obj</span> <span class="ow">and</span> <span class="n">dep</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">deps</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_async</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_val</span> <span class="o">=</span> <span class="n">resolve_value</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">recursive</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">Skip</span><span class="p">:</span>
                <span class="n">new_val</span> <span class="o">=</span> <span class="n">Undefined</span>
            <span class="k">if</span> <span class="n">new_val</span> <span class="ow">is</span> <span class="n">Skip</span> <span class="ow">or</span> <span class="n">new_val</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">is_async</span><span class="p">:</span>
                <span class="n">async_executor</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">_async_ref</span><span class="p">,</span> <span class="n">pname</span><span class="p">,</span> <span class="n">new_val</span><span class="p">))</span>
                <span class="k">continue</span>

            <span class="n">updates</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_val</span>

        <span class="k">with</span> <span class="n">edit_constant</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">_syncing</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="p">,</span> <span class="n">updates</span><span class="p">):</span>
                <span class="n">self_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">updates</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resolve_ref</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">pobj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">is_gen</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isgeneratorfunction</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">is_async</span> <span class="o">=</span> <span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_gen</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="n">resolve_ref</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">pobj</span><span class="o">.</span><span class="n">nested_refs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">deps</span> <span class="ow">or</span> <span class="n">is_async</span> <span class="ow">or</span> <span class="n">is_gen</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="kc">False</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">resolve_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">pobj</span><span class="o">.</span><span class="n">nested_refs</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Skip</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">Undefined</span>
        <span class="k">if</span> <span class="n">is_async</span><span class="p">:</span>
            <span class="n">async_executor</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">_async_ref</span><span class="p">,</span> <span class="n">pobj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">ref</span><span class="p">,</span> <span class="n">deps</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">is_async</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_async_ref</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">pname</span><span class="p">,</span> <span class="n">awaitable</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">initialized</span><span class="p">:</span>
            <span class="n">async_executor</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">_async_ref</span><span class="p">,</span> <span class="n">pname</span><span class="p">,</span> <span class="n">awaitable</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="n">current_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">current_task</span><span class="p">()</span>
        <span class="n">running_task</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">async_refs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">running_task</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">async_refs</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_task</span>
        <span class="k">elif</span> <span class="n">current_task</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">running_task</span><span class="p">:</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">async_refs</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">awaitable</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">AsyncGeneratorType</span><span class="p">):</span>
                <span class="k">async</span> <span class="k">for</span> <span class="n">new_obj</span> <span class="ow">in</span> <span class="n">awaitable</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">_syncing</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="p">,</span> <span class="p">(</span><span class="n">pname</span><span class="p">,)):</span>
                        <span class="n">self_</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">pname</span><span class="p">:</span> <span class="n">new_obj</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">_syncing</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="p">,</span> <span class="p">(</span><span class="n">pname</span><span class="p">,)):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">self_</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">pname</span><span class="p">:</span> <span class="k">await</span> <span class="n">awaitable</span><span class="p">})</span>
                    <span class="k">except</span> <span class="n">Skip</span><span class="p">:</span>
                        <span class="k">pass</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Ensure we clean up but only if the task matches the currrent task</span>
            <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">async_refs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pname</span><span class="p">)</span> <span class="ow">is</span> <span class="n">current_task</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">async_refs</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_changed</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predicate that determines whether a Event object has actually</span>
<span class="sd">        changed such that old != new.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">Comparator</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">old</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">new</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_instantiate_param</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">param_obj</span><span class="p">,</span> <span class="n">dict_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deepcopy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># deepcopy or store a reference to reference param_obj.default into</span>
        <span class="c1"># self._param__private.values (or dict_ if supplied) under the</span>
        <span class="c1"># parameter&#39;s name (or key if supplied)</span>
        <span class="n">instantiator</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span> <span class="k">if</span> <span class="n">deepcopy</span> <span class="k">else</span> <span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>
        <span class="n">dict_</span> <span class="o">=</span> <span class="n">dict_</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">values</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span> <span class="ow">or</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_share</span><span class="p">:</span>
            <span class="n">param_key</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">param_key</span> <span class="ow">in</span> <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_shared_cache</span><span class="p">:</span>
                <span class="n">new_object</span> <span class="o">=</span> <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_shared_cache</span><span class="p">[</span><span class="n">param_key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_object</span> <span class="o">=</span> <span class="n">instantiator</span><span class="p">(</span><span class="n">param_obj</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
                <span class="n">shared_parameters</span><span class="o">.</span><span class="n">_shared_cache</span><span class="p">[</span><span class="n">param_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_object</span> <span class="o">=</span> <span class="n">instantiator</span><span class="p">(</span><span class="n">param_obj</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>

        <span class="n">dict_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_object</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_object</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">):</span>
            <span class="k">global</span> <span class="n">object_count</span>
            <span class="n">object_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Writes over name given to the original object;</span>
            <span class="c1"># could instead have kept the same name</span>
            <span class="n">new_object</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_generate_name</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_deps</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>
        <span class="n">init_methods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">queued</span><span class="p">,</span> <span class="n">on_init</span><span class="p">,</span> <span class="n">constant</span><span class="p">,</span> <span class="n">dynamic</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_depends</span><span class="p">[</span><span class="s1">&#39;watch&#39;</span><span class="p">]:</span>
            <span class="c1"># On initialization set up constant watchers; otherwise</span>
            <span class="c1"># clean up previous dynamic watchers for the updated attribute</span>
            <span class="n">dynamic</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dynamic</span> <span class="k">if</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">d</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">attribute</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">init</span><span class="p">:</span>
                <span class="n">constant_grouped</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">_resolve_mcs_deps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">constant</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">constant_grouped</span><span class="p">[(</span><span class="nb">id</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">inst</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">cls</span><span class="p">),</span> <span class="n">dep</span><span class="o">.</span><span class="n">what</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="n">dep</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">constant_grouped</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">self_</span><span class="o">.</span><span class="n">_watch_group</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">queued</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">on_init</span> <span class="ow">and</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">init_methods</span><span class="p">:</span>
                    <span class="n">init_methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dynamic</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">dynamic_watchers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">cls</span> <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">w</span><span class="o">.</span><span class="n">inst</span><span class="p">)</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">unwatch</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Resolve dynamic dependencies one-by-one to be able to trace their watchers</span>
            <span class="n">grouped</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ddep</span> <span class="ow">in</span> <span class="n">dynamic</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">_resolve_mcs_deps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="n">ddep</span><span class="p">]):</span>
                    <span class="n">grouped</span><span class="p">[(</span><span class="nb">id</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">inst</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">cls</span><span class="p">),</span> <span class="n">dep</span><span class="o">.</span><span class="n">what</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ddep</span><span class="p">,</span> <span class="n">dep</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">watcher</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_watch_group</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">queued</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">dynamic_watchers</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">watcher</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">init_methods</span><span class="p">:</span>
            <span class="n">m</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_resolve_dynamic_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">dynamic_dep</span><span class="p">,</span> <span class="n">param_dep</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If a subobject whose parameters are being depended on changes</span>
<span class="sd">        we should only trigger events if the actual parameter values</span>
<span class="sd">        of the new object differ from those on the old subobject,</span>
<span class="sd">        therefore we accumulate parameters to compare on a subobject</span>
<span class="sd">        change event.</span>

<span class="sd">        Additionally we need to make sure to notify the parent object</span>
<span class="sd">        if a subobject changes so the dependencies can be</span>
<span class="sd">        reinitialized so we return a callback which updates the</span>
<span class="sd">        dependencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subobj</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="n">subobjs</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">subpath</span> <span class="ow">in</span> <span class="n">dynamic_dep</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">subobj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subobj</span><span class="p">,</span> <span class="n">subpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">subobjs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subobj</span><span class="p">)</span>

        <span class="n">dep_obj</span> <span class="o">=</span> <span class="n">param_dep</span><span class="o">.</span><span class="n">cls</span> <span class="k">if</span> <span class="n">param_dep</span><span class="o">.</span><span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">param_dep</span><span class="o">.</span><span class="n">inst</span>
        <span class="k">if</span> <span class="n">dep_obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subobjs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">param_dep</span><span class="o">.</span><span class="n">what</span>

        <span class="n">depth</span> <span class="o">=</span> <span class="n">subobjs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">dep_obj</span><span class="p">)</span>
        <span class="n">callback</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="o">*</span><span class="n">events</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                If a subobject changes, we need to notify the main</span>
<span class="sd">                object to update the dependencies.</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_update_deps</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dynamic_dep</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;param&#39;</span><span class="p">:</span>
            <span class="n">subparams</span> <span class="o">=</span> <span class="p">[</span><span class="n">sp</span> <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">subobjs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">param</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subparams</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">dynamic_dep</span><span class="o">.</span><span class="n">spec</span><span class="p">:</span>
            <span class="n">what</span> <span class="o">=</span> <span class="n">dynamic_dep</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">what</span> <span class="o">=</span> <span class="n">param_dep</span><span class="o">.</span><span class="n">what</span>

        <span class="k">return</span> <span class="n">subparams</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">what</span>

    <span class="k">def</span> <span class="nf">_watch_group</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">queued</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up a watcher for a group of dependencies. Ensures that</span>
<span class="sd">        if the dependency was dynamically generated we check whether</span>
<span class="sd">        a subobject change event actually causes a value change and</span>
<span class="sd">        that we update the existing watchers, i.e. clean up watchers</span>
<span class="sd">        on the old subobject and create watchers on the new subobject.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dynamic_dep</span><span class="p">,</span> <span class="n">param_dep</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dep_obj</span> <span class="o">=</span> <span class="n">param_dep</span><span class="o">.</span><span class="n">cls</span> <span class="k">if</span> <span class="n">param_dep</span><span class="o">.</span><span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">param_dep</span><span class="o">.</span><span class="n">inst</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dynamic_dep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">subparams</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">what</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">param_dep</span><span class="o">.</span><span class="n">what</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subparams</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">what</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_resolve_dynamic_deps</span><span class="p">(</span>
                <span class="n">obj</span><span class="p">,</span> <span class="n">dynamic_dep</span><span class="p">,</span> <span class="n">param_dep</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span>

        <span class="n">mcaller</span> <span class="o">=</span> <span class="n">_m_caller</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="n">subparams</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dep_obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_watch</span><span class="p">(</span>
            <span class="n">mcaller</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">param_dep</span><span class="o">.</span><span class="n">what</span><span class="p">,</span> <span class="n">queued</span><span class="o">=</span><span class="n">queued</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@_recursive_repr</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_parameterized_repr_html</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="nb">open</span><span class="p">)</span>

    <span class="c1"># Classmethods</span>

    <span class="c1"># PARAM3_DEPRECATION</span>
<div class="viewcode-block" id="Parameters.print_param_defaults"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.print_param_defaults.html#param.Parameters.print_param_defaults">[docs]</a>    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Use instead `for k,v in p.param.objects().items(): print(f&quot;</span><span class="si">{p.__class__.name}</span><span class="s2">.</span><span class="si">{k}</span><span class="s2">={repr(v.default)}&quot;)`&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">print_param_defaults</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the default values of all cls&#39;s Parameters.</span>

<span class="sd">        .. deprecated:: 1.12.0</span>
<span class="sd">            Use instead `for k,v in p.param.objects().items(): print(f&quot;{p.__class__.name}.{k}={repr(v.default)}&quot;)`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">Parameter</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span> <span class="s1">&#39;=&#39;</span><span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">default</span><span class="p">))</span></div>

    <span class="c1"># PARAM3_DEPRECATION</span>
<div class="viewcode-block" id="Parameters.set_default"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.set_default.html#param.Parameters.set_default">[docs]</a>    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;Use instead `p.param.default =`&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_default</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">param_name</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the default value of param_name.</span>

<span class="sd">        Equivalent to setting param_name on the class.</span>

<span class="sd">        .. deprecated:: 1.12.0</span>
<span class="sd">             Use instead `p.param.default =`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">param_name</span><span class="p">,</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.add_parameter"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.add_parameter.html#param.Parameters.add_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">add_parameter</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new Parameter object into this object&#39;s class.</span>

<span class="sd">        Should result in a Parameter equivalent to one declared</span>
<span class="sd">        in the class&#39;s source code.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Could have just done setattr(cls,param_name,param_obj),</span>
        <span class="c1"># which is supported by the metaclass&#39;s __setattr__ , but</span>
        <span class="c1"># would need to handle the params() cache as well</span>
        <span class="c1"># (which is tricky but important for startup speed).</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span>
        <span class="nb">type</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_obj</span><span class="p">)</span>
        <span class="n">ParameterizedMetaclass</span><span class="o">.</span><span class="n">_initialize_parameter</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_obj</span><span class="p">)</span>
        <span class="c1"># delete cached params()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

    <span class="c1"># PARAM3_DEPRECATION</span>
    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;Use instead `.param.add_parameter`&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_add_parameter</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param_obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a new Parameter object into this object&#39;s class.</span>

<span class="sd">        .. deprecated :: 1.12.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param_obj</span><span class="p">)</span>

    <span class="c1"># PARAM3_DEPRECATION</span>
<div class="viewcode-block" id="Parameters.params"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.params.html#param.Parameters.params">[docs]</a>    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;Use instead `.param.values()` or `.param[&#39;param&#39;]`&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">parameter_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the Parameters of this class as the</span>
<span class="sd">        dictionary {name: parameter_object}</span>

<span class="sd">        Includes Parameters from this class and its</span>
<span class="sd">        superclasses.</span>

<span class="sd">        .. deprecated:: 1.12.0</span>
<span class="sd">            Use instead `.param.values()` or `.param[&#39;param&#39;]`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pdict</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="s1">&#39;existing&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parameter_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pdict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pdict</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span></div>

    <span class="c1"># Bothmethods</span>

<div class="viewcode-block" id="Parameters.update"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.update.html#param.Parameters.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For the given dictionary or iterable or set of param=value</span>
<span class="sd">        keyword arguments, sets the corresponding parameter of this</span>
<span class="sd">        object or class to the given value.</span>

<span class="sd">        May also be used as a context manager to temporarily set and</span>
<span class="sd">        then reset parameter values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">refs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">private</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span>
            <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span> <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="n">Undefined</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">pname</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pname</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">pname</span> <span class="ow">in</span> <span class="n">private</span><span class="o">.</span><span class="n">refs</span><span class="p">:</span>
                    <span class="n">refs</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span> <span class="o">=</span> <span class="n">private</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">pname</span> <span class="ow">in</span> <span class="n">private</span><span class="o">.</span><span class="n">async_refs</span><span class="p">:</span>
                    <span class="n">refs</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span> <span class="o">=</span> <span class="n">private</span><span class="o">.</span><span class="n">async_refs</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span>
        <span class="n">restore</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">_ParametersRestorer</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">self_</span><span class="p">,</span> <span class="n">restore</span><span class="o">=</span><span class="n">restore</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="n">refs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">BATCH_WATCH</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_BATCH_WATCH</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">trigger_params</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">self_</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">self_</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="s1">&#39;_autotrigger_value&#39;</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">trigger_params</span><span class="p">:</span>
            <span class="n">self_</span><span class="p">[</span><span class="n">tp</span><span class="p">]</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="s1">&#39;set&#39;</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">restore</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">values</span><span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self_</span><span class="p">:</span>
                <span class="n">self_</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">!r}</span><span class="s2"> is not a parameter of </span><span class="si">{</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">self_</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">raise</span>

        <span class="n">self_</span><span class="o">.</span><span class="n">_BATCH_WATCH</span> <span class="o">=</span> <span class="n">BATCH_WATCH</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">BATCH_WATCH</span><span class="p">:</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">_batch_call_watchers</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">trigger_params</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">self_</span><span class="p">[</span><span class="n">tp</span><span class="p">]</span>
            <span class="n">p</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="s1">&#39;reset&#39;</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">_autotrigger_reset_value</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="s1">&#39;set-reset&#39;</span>
        <span class="k">return</span> <span class="n">restore</span>

    <span class="c1"># PARAM3_DEPRECATION</span>
<div class="viewcode-block" id="Parameters.set_param"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.set_param.html#param.Parameters.set_param">[docs]</a>    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;Use instead `.param.update`&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_param</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For each param=value keyword argument, sets the corresponding</span>
<span class="sd">        parameter of this object or class to the given value.</span>

<span class="sd">        For backwards compatibility, also accepts</span>
<span class="sd">        set_param(&quot;param&quot;,value) for a single parameter value using</span>
<span class="sd">        positional arguments, but the keyword interface is preferred</span>
<span class="sd">        because it is more compact and can set multiple values.</span>

<span class="sd">        .. deprecated:: 1.12.0</span>
<span class="sd">            Use instead `.param.update`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid positional arguments for </span><span class="si">%s</span><span class="s2">.set_param&quot;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_cls_parameters</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class parameters are cached because they are accessed often,</span>
<span class="sd">        and parameters are rarely added (and cannot be deleted)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span>
        <span class="n">pdict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">params</span>
        <span class="k">if</span> <span class="n">pdict</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pdict</span>

        <span class="n">paramdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="n">classlist</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">class_</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
                    <span class="n">paramdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="c1"># We only want the cache to be visible to the cls on which</span>
        <span class="c1"># params() is called, so we mangle the name ourselves at</span>
        <span class="c1"># runtime (if we were to mangle it now, it would be</span>
        <span class="c1"># _Parameterized.__params for all classes).</span>
        <span class="c1"># cls._param__private.params[f&#39;_{cls.__name__}__params&#39;] = paramdict</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">paramdict</span>
        <span class="k">return</span> <span class="n">paramdict</span>

<div class="viewcode-block" id="Parameters.objects"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.objects.html#param.Parameters.objects">[docs]</a>    <span class="k">def</span> <span class="nf">objects</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Parameters of this instance or class</span>

<span class="sd">        If instance=True and called on a Parameterized instance it</span>
<span class="sd">        will create instance parameters for all Parameters defined on</span>
<span class="sd">        the class. To force class parameters to be returned use</span>
<span class="sd">        instance=False. Since classes avoid creating instance</span>
<span class="sd">        parameters unless necessary you may also request only existing</span>
<span class="sd">        instance parameters to be returned by setting</span>
<span class="sd">        instance=&#39;existing&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">initialized</span> <span class="ow">and</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s1">&#39;Looking up instance Parameter objects (`.param.objects()`) until &#39;</span>
                <span class="s1">&#39;the Parameterized instance has been fully initialized is deprecated and will raise an error in a future version. &#39;</span>
                <span class="s1">&#39;Ensure you have called `super().__init__(**params)` in your Parameterized &#39;</span>
                <span class="s1">&#39;constructor before trying to access instance Parameter objects, or &#39;</span>
                <span class="s1">&#39;looking up the class Parameter objects with `.param.objects(instance=False)` &#39;</span>
                <span class="s1">&#39;may be enough for your use case.&#39;</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="n">_ParamFutureWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">pdict</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_cls_parameters</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">and</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">instance</span> <span class="o">==</span> <span class="s1">&#39;existing&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="p">,</span> <span class="s1">&#39;initialized&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pdict</span><span class="p">,</span> <span class="o">**</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pdict</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pdict</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">pdict</span></div>

<div class="viewcode-block" id="Parameters.trigger"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.trigger.html#param.Parameters.trigger">[docs]</a>    <span class="k">def</span> <span class="nf">trigger</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">param_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trigger watchers for the given set of parameter names. Watchers</span>
<span class="sd">        will be triggered whether or not the parameter values have</span>
<span class="sd">        actually changed. As a special case, the value will actually be</span>
<span class="sd">        changed for a Parameter of type Event, setting it to True so</span>
<span class="sd">        that it is clear which Event parameter has been triggered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">initialized</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s1">&#39;Triggering watchers on a partially initialized Parameterized instance &#39;</span>
                <span class="s1">&#39;is deprecated and will raise an error in a future version. &#39;</span>
                <span class="s1">&#39;Ensure you have called super().__init__(**params) in &#39;</span>
                <span class="s1">&#39;the Parameterized instance constructor before trying to set up a watcher.&#39;</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="n">_ParamFutureWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">trigger_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">self_</span>
                          <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">self_</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="s1">&#39;_autotrigger_value&#39;</span><span class="p">)]</span>
        <span class="n">triggers</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span><span class="n">self_</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">_autotrigger_value</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">trigger_params</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">}</span>

        <span class="n">events</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_events</span>
        <span class="n">watchers</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_state_watchers</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">_events</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">_state_watchers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">param_values</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">param_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">}</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">_TRIGGER</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">triggers</span><span class="p">))</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">_TRIGGER</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">_events</span> <span class="o">+=</span> <span class="n">events</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">_state_watchers</span> <span class="o">+=</span> <span class="n">watchers</span></div>

    <span class="k">def</span> <span class="nf">_update_event_type</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">watcher</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">triggered</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an updated Event object with the type field set appropriately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">triggered</span><span class="p">:</span>
            <span class="n">event_type</span> <span class="o">=</span> <span class="s1">&#39;triggered&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event_type</span> <span class="o">=</span> <span class="s1">&#39;changed&#39;</span> <span class="k">if</span> <span class="n">watcher</span><span class="o">.</span><span class="n">onlychanged</span> <span class="k">else</span> <span class="s1">&#39;set&#39;</span>
        <span class="k">return</span> <span class="n">Event</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">what</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span>
                     <span class="n">old</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">new</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">event_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_watcher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">watcher</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">watcher</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;args&#39;</span><span class="p">:</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">events</span><span class="p">,</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="p">(),</span> <span class="p">{</span><span class="n">event</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">new</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">watcher</span><span class="o">.</span><span class="n">fn</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">async_executor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not execute </span><span class="si">%s</span><span class="s2"> coroutine function. &quot;</span>
                                   <span class="s2">&quot;Please register a asynchronous executor on &quot;</span>
                                   <span class="s2">&quot;param.parameterized.async_executor, which &quot;</span>
                                   <span class="s2">&quot;schedules the function on an event loop.&quot;</span> <span class="o">%</span>
                                   <span class="n">watcher</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>
            <span class="n">async_executor</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">watcher</span><span class="o">.</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">watcher</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">Skip</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_call_watcher</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">watcher</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Invoke the given watcher appropriately given an Event object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">_TRIGGER</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">watcher</span><span class="o">.</span><span class="n">onlychanged</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">self_</span><span class="o">.</span><span class="n">_changed</span><span class="p">(</span><span class="n">event</span><span class="p">)):</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">_BATCH_WATCH</span><span class="p">:</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">watcher</span> <span class="ow">is</span> <span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">self_</span><span class="o">.</span><span class="n">_state_watchers</span><span class="p">):</span>
                <span class="n">self_</span><span class="o">.</span><span class="n">_state_watchers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">watcher</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_update_event_type</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">self_</span><span class="o">.</span><span class="n">_TRIGGER</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">_batch_call_watchers</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="n">watcher</span><span class="o">.</span><span class="n">queued</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">self_</span><span class="o">.</span><span class="n">_execute_watcher</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="p">(</span><span class="n">event</span><span class="p">,))</span>

    <span class="k">def</span> <span class="nf">_batch_call_watchers</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Batch call a set of watchers based on the parameter value</span>
<span class="sd">        settings in kwargs using the queued Event and watcher objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="n">self_</span><span class="o">.</span><span class="n">_events</span><span class="p">:</span>
            <span class="n">event_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([((</span><span class="n">event</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">what</span><span class="p">),</span> <span class="n">event</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">self_</span><span class="o">.</span><span class="n">_events</span><span class="p">])</span>
            <span class="n">watchers</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_state_watchers</span><span class="p">[:]</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">_events</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">_state_watchers</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">watcher</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">watchers</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">precedence</span><span class="p">):</span>
                <span class="n">events</span> <span class="o">=</span> <span class="p">[</span><span class="n">self_</span><span class="o">.</span><span class="n">_update_event_type</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="n">event_dict</span><span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">watcher</span><span class="o">.</span><span class="n">what</span><span class="p">)],</span>
                                                   <span class="n">self_</span><span class="o">.</span><span class="n">_TRIGGER</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">watcher</span><span class="o">.</span><span class="n">parameter_names</span>
                          <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">watcher</span><span class="o">.</span><span class="n">what</span><span class="p">)</span> <span class="ow">in</span> <span class="n">event_dict</span><span class="p">]</span>
                <span class="k">with</span> <span class="n">_batch_call_watchers</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="n">watcher</span><span class="o">.</span><span class="n">queued</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                    <span class="n">self_</span><span class="o">.</span><span class="n">_execute_watcher</span><span class="p">(</span><span class="n">watcher</span><span class="p">,</span> <span class="n">events</span><span class="p">)</span>

<div class="viewcode-block" id="Parameters.set_dynamic_time_fn"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.set_dynamic_time_fn.html#param.Parameters.set_dynamic_time_fn">[docs]</a>    <span class="k">def</span> <span class="nf">set_dynamic_time_fn</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">time_fn</span><span class="p">,</span><span class="n">sublistattr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set time_fn for all Dynamic Parameters of this class or</span>
<span class="sd">        instance object that are currently being dynamically</span>
<span class="sd">        generated.</span>

<span class="sd">        Additionally, sets _Dynamic_time_fn=time_fn on this class or</span>
<span class="sd">        instance object, so that any future changes to Dynamic</span>
<span class="sd">        Parmeters can inherit time_fn (e.g. if a Number is changed</span>
<span class="sd">        from a float to a number generator, the number generator will</span>
<span class="sd">        inherit time_fn).</span>

<span class="sd">        If specified, sublistattr is the name of an attribute of this</span>
<span class="sd">        class or instance that contains an iterable collection of</span>
<span class="sd">        subobjects on which set_dynamic_time_fn should be called.  If</span>
<span class="sd">        the attribute sublistattr is present on any of the subobjects,</span>
<span class="sd">        set_dynamic_time_fn() will be called for those, too.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_Dynamic_time_fn</span> <span class="o">=</span> <span class="n">time_fn</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="n">self_or_cls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">self_or_cls</span><span class="p">,)</span>

        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">&#39;existing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;_value_is_dynamic&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">_value_is_dynamic</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">):</span>
                    <span class="n">g</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_value_generator</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">_Dynamic_time_fn</span> <span class="o">=</span> <span class="n">time_fn</span>

        <span class="k">if</span> <span class="n">sublistattr</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sublist</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span><span class="n">sublistattr</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">sublist</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">set_dynamic_time_fn</span><span class="p">(</span><span class="n">time_fn</span><span class="p">,</span><span class="n">sublistattr</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.serialize_parameters"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.serialize_parameters.html#param.Parameters.serialize_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">serialize_parameters</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">mode</span><span class="si">!r}</span><span class="s1"> not in available serialization formats </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">serializer</span><span class="o">.</span><span class="n">serialize_parameters</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.serialize_value"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.serialize_value.html#param.Parameters.serialize_value">[docs]</a>    <span class="k">def</span> <span class="nf">serialize_value</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">pname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">mode</span><span class="si">!r}</span><span class="s1"> not in available serialization formats </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">serializer</span><span class="o">.</span><span class="n">serialize_parameter_value</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">pname</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.deserialize_parameters"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.deserialize_parameters.html#param.Parameters.deserialize_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">deserialize_parameters</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">serialization</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">serializer</span><span class="o">.</span><span class="n">deserialize_parameters</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">serialization</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.deserialize_value"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.deserialize_value.html#param.Parameters.deserialize_value">[docs]</a>    <span class="k">def</span> <span class="nf">deserialize_value</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">pname</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">mode</span><span class="si">!r}</span><span class="s1"> not in available serialization formats </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">serializer</span><span class="o">.</span><span class="n">deserialize_parameter_value</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">pname</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.schema"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.schema.html#param.Parameters.schema">[docs]</a>    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a schema for the parameters on this Parameterized object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">mode</span><span class="si">!r}</span><span class="s1"> not in available serialization formats </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_serializers</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">serializer</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="n">safe</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span></div>

    <span class="c1"># PARAM3_DEPRECATION</span>
    <span class="c1"># same as values() but returns list, not dict</span>
<div class="viewcode-block" id="Parameters.get_param_values"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.get_param_values.html#param.Parameters.get_param_values">[docs]</a>    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Use `.param.values().items()` instead (or `.param.values()` for the</span>
<span class="s2">        common case of `dict(....param.get_param_values())`)</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_param_values</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">onlychanged</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of name,value pairs for all Parameters of this</span>
<span class="sd">        object.</span>

<span class="sd">        When called on an instance with onlychanged set to True, will</span>
<span class="sd">        only return values that are not equal to the default value</span>
<span class="sd">        (onlychanged has no effect when called on a class).</span>

<span class="sd">        .. deprecated:: 1.12.0</span>
<span class="sd">            Use `.param.values().items()` instead (or `.param.values()` for the</span>
<span class="sd">            common case of `dict(....param.get_param_values())`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">onlychanged</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span></div>

<div class="viewcode-block" id="Parameters.values"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.values.html#param.Parameters.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">onlychanged</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary of name,value pairs for the Parameters of this</span>
<span class="sd">        object.</span>

<span class="sd">        When called on an instance with onlychanged set to True, will</span>
<span class="sd">        only return values that are not equal to the default value</span>
<span class="sd">        (onlychanged has no effect when called on a class).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">&#39;existing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_value_generator</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span> <span class="ow">and</span> <span class="n">onlychanged</span> <span class="ow">and</span> <span class="n">_is_auto_name</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">onlychanged</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">Comparator</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">default</span><span class="p">):</span>
                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="n">vals</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.force_new_dynamic_value"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.force_new_dynamic_value.html#param.Parameters.force_new_dynamic_value">[docs]</a>    <span class="k">def</span> <span class="nf">force_new_dynamic_value</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span> <span class="c1"># pylint: disable-msg=E0213</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Force a new value to be generated for the dynamic attribute</span>
<span class="sd">        name, and return it.</span>

<span class="sd">        If name is not dynamic, its current value is returned</span>
<span class="sd">        (i.e. equivalent to getattr(name).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cls_or_slf</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="n">param_obj</span> <span class="o">=</span> <span class="n">cls_or_slf</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">&#39;existing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">param_obj</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="bp">cls</span><span class="p">,</span> <span class="n">slf</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">cls_or_slf</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slf</span> <span class="o">=</span> <span class="n">cls_or_slf</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">param_obj</span><span class="p">,</span><span class="s1">&#39;_force&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">param_obj</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">slf</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">_force</span><span class="p">(</span><span class="n">slf</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.get_value_generator"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.get_value_generator.html#param.Parameters.get_value_generator">[docs]</a>    <span class="k">def</span> <span class="nf">get_value_generator</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">name</span><span class="p">):</span> <span class="c1"># pylint: disable-msg=E0213</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the value or value-generating object of the named</span>
<span class="sd">        attribute.</span>

<span class="sd">        For most parameters, this is simply the parameter&#39;s value</span>
<span class="sd">        (i.e. the same as getattr()), but Dynamic parameters have</span>
<span class="sd">        their value-generating object returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cls_or_slf</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="n">param_obj</span> <span class="o">=</span> <span class="n">cls_or_slf</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">&#39;existing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">param_obj</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># CompositeParameter detected by being a Parameter and having &#39;attribs&#39;</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">param_obj</span><span class="p">,</span><span class="s1">&#39;attribs&#39;</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">cls_or_slf</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_value_generator</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">attribs</span><span class="p">]</span>

        <span class="c1"># not a Dynamic Parameter</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">param_obj</span><span class="p">,</span><span class="s1">&#39;_value_is_dynamic&#39;</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Dynamic Parameter...</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># TODO: is this always an instance?</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cls_or_slf</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="c1"># dealing with object and it&#39;s been set on this object</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">cls_or_slf</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># dealing with class or isn&#39;t set on the object</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">default</span>

        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Parameters.inspect_value"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.inspect_value.html#param.Parameters.inspect_value">[docs]</a>    <span class="k">def</span> <span class="nf">inspect_value</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">name</span><span class="p">):</span> <span class="c1"># pylint: disable-msg=E0213</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the current value of the named attribute without modifying it.</span>

<span class="sd">        Same as getattr() except for Dynamic parameters, which have their</span>
<span class="sd">        last generated value returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cls_or_slf</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="n">param_obj</span> <span class="o">=</span> <span class="n">cls_or_slf</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">&#39;existing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">param_obj</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">param_obj</span><span class="p">,</span><span class="s1">&#39;attribs&#39;</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">cls_or_slf</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">inspect_value</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">attribs</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">param_obj</span><span class="p">,</span><span class="s1">&#39;_inspect&#39;</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">_inspect</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="n">cls_or_slf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">param_obj</span><span class="o">.</span><span class="n">_inspect</span><span class="p">(</span><span class="n">cls_or_slf</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Parameters.method_dependencies"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.method_dependencies.html#param.Parameters.method_dependencies">[docs]</a>    <span class="k">def</span> <span class="nf">method_dependencies</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">intermediate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the name of a method, returns a PInfo object for each dependency</span>
<span class="sd">        of this method. See help(PInfo) for the contents of these objects.</span>

<span class="sd">        By default intermediate dependencies on sub-objects are not</span>
<span class="sd">        returned as these are primarily useful for internal use to</span>
<span class="sd">        determine when a sub-object dependency has to be updated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">minfo</span> <span class="o">=</span> <span class="n">MInfo</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span> <span class="n">inst</span><span class="o">=</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                      <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="n">deps</span><span class="p">,</span> <span class="n">dynamic</span> <span class="o">=</span> <span class="n">_params_depended_on</span><span class="p">(</span>
            <span class="n">minfo</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">intermediate</span><span class="o">=</span><span class="n">intermediate</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">deps</span>
        <span class="k">return</span> <span class="n">_resolve_mcs_deps</span><span class="p">(</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="p">,</span> <span class="n">deps</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">,</span> <span class="n">intermediate</span><span class="o">=</span><span class="n">intermediate</span><span class="p">)</span></div>

    <span class="c1"># PARAM3_DEPRECATION</span>
<div class="viewcode-block" id="Parameters.params_depended_on"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.params_depended_on.html#param.Parameters.params_depended_on">[docs]</a>    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s1">&#39;Use instead `.param.method_dependencies`&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">params_depended_on</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the name of a method, returns a PInfo object for each dependency</span>
<span class="sd">        of this method. See help(PInfo) for the contents of these objects.</span>

<span class="sd">        By default intermediate dependencies on sub-objects are not</span>
<span class="sd">        returned as these are primarily useful for internal use to</span>
<span class="sd">        determine when a sub-object dependency has to be updated.</span>

<span class="sd">        .. deprecated: 2.0.0</span>
<span class="sd">            Use instead `.param.method_dependencies`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">method_dependencies</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.outputs"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.outputs.html#param.Parameters.outputs">[docs]</a>    <span class="k">def</span> <span class="nf">outputs</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a mapping between any declared outputs and a tuple</span>
<span class="sd">        of the declared Parameter type, the output method, and the</span>
<span class="sd">        index into the output if multiple outputs are returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">classlist</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;_param_watchers&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">dinfo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s1">&#39;_dinfo&#39;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="k">if</span> <span class="s1">&#39;outputs&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dinfo</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">override</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">dinfo</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">override</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">override</span>
                    <span class="n">outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">otype</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

    <span class="k">def</span> <span class="nf">_spec_to_obj</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">intermediate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resolves a dependency specification into lists of explicit</span>
<span class="sd">        parameter dependencies and dynamic dependencies.</span>

<span class="sd">        Dynamic dependencies are specifications to be resolved when</span>
<span class="sd">        the sub-object whose parameters are being depended on is</span>
<span class="sd">        defined.</span>

<span class="sd">        During class creation dynamic=False which means sub-object</span>
<span class="sd">        dependencies are not resolved. At instance creation and</span>
<span class="sd">        whenever a sub-object is set on an object this method will be</span>
<span class="sd">        invoked to determine whether the dependency is available.</span>

<span class="sd">        For sub-object dependencies we also return dependencies for</span>
<span class="sd">        every part of the path, e.g. for a dependency specification</span>
<span class="sd">        like &quot;a.b.c&quot; we return dependencies for sub-object &quot;a&quot; and the</span>
<span class="sd">        sub-sub-object &quot;b&quot; in addition to the dependency on the actual</span>
<span class="sd">        parameter &quot;c&quot; on object &quot;b&quot;. This is to ensure that if a</span>
<span class="sd">        sub-object is swapped out we are notified and can update the</span>
<span class="sd">        dynamic dependency to the new object. Even if a sub-object</span>
<span class="sd">        dependency can only partially resolved, e.g. if object &quot;a&quot;</span>
<span class="sd">        does not yet have a sub-object &quot;b&quot; we must watch for changes</span>
<span class="sd">        to &quot;b&quot; on sub-object &quot;a&quot; in case such a subobject is put in &quot;b&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">owner</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">owner</span> <span class="k">if</span> <span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">type</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">PInfo</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">inst</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                         <span class="n">pobj</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">intermediate</span> <span class="o">==</span> <span class="s1">&#39;only&#39;</span> <span class="k">else</span> <span class="p">[</span><span class="n">info</span><span class="p">],</span> <span class="p">[]</span>

        <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">what</span> <span class="o">=</span> <span class="n">_parse_dependency_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">dynamic</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[],</span> <span class="p">[</span><span class="n">DInfo</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Dependency </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">!r}</span><span class="s1"> could not be resolved, </span><span class="si">{</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="si">}</span><span class="s1"> &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;has no parameter or attribute </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="si">!r}</span><span class="s1">. Ensure &#39;</span>
                    <span class="s1">&#39;the object being depended on is declared before calling the &#39;</span>
                    <span class="s1">&#39;Parameterized constructor.&#39;</span>
                <span class="p">)</span>

            <span class="n">src</span> <span class="o">=</span> <span class="n">_getattrr</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">::],</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">src</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">deps</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c1"># Attempt to partially resolve subobject path to ensure</span>
                <span class="c1"># that if a subobject is later updated making the full</span>
                <span class="c1"># subobject path available we have to be notified and</span>
                <span class="c1"># set up watchers</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">intermediate</span><span class="p">:</span>
                    <span class="n">sub_src</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">subpath</span> <span class="o">=</span> <span class="n">path</span>
                    <span class="k">while</span> <span class="n">sub_src</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">subpath</span><span class="p">:</span>
                        <span class="n">subpath</span> <span class="o">=</span> <span class="n">subpath</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">sub_src</span> <span class="o">=</span> <span class="n">_getattrr</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subpath</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">subpath</span><span class="p">:</span>
                        <span class="n">subdeps</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_spec_to_obj</span><span class="p">(</span>
                            <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">subpath</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dynamic</span><span class="p">,</span> <span class="n">intermediate</span><span class="p">)</span>
                        <span class="n">deps</span> <span class="o">+=</span> <span class="n">subdeps</span>
                <span class="k">return</span> <span class="n">deps</span><span class="p">,</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">intermediate</span> <span class="o">==</span> <span class="s1">&#39;only&#39;</span> <span class="k">else</span> <span class="p">[</span><span class="n">DInfo</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)]</span>

        <span class="bp">cls</span><span class="p">,</span> <span class="n">inst</span> <span class="o">=</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">src</span><span class="p">),</span> <span class="n">src</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;param&#39;</span><span class="p">:</span>
            <span class="n">deps</span><span class="p">,</span> <span class="n">dynamic_deps</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_spec_to_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dynamic</span><span class="p">,</span> <span class="n">intermediate</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">param</span><span class="p">:</span>
                <span class="n">param_deps</span><span class="p">,</span> <span class="n">param_dynamic_deps</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_spec_to_obj</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">,</span> <span class="n">intermediate</span><span class="p">)</span>
                <span class="n">deps</span> <span class="o">+=</span> <span class="n">param_deps</span>
                <span class="n">dynamic_deps</span> <span class="o">+=</span> <span class="n">param_dynamic_deps</span>
            <span class="k">return</span> <span class="n">deps</span><span class="p">,</span> <span class="n">dynamic_deps</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">param</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">PInfo</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">inst</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">attr</span><span class="p">,</span>
                         <span class="n">pobj</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="n">what</span><span class="o">=</span><span class="n">what</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
            <span class="n">attr_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_obj</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_obj</span><span class="p">,</span> <span class="p">(</span><span class="n">FunctionType</span><span class="p">,</span> <span class="n">MethodType</span><span class="p">)):</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">MInfo</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">inst</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">attr</span><span class="p">,</span>
                             <span class="n">method</span><span class="o">=</span><span class="n">attr_obj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attribute </span><span class="si">{</span><span class="n">attr</span><span class="si">!r}</span><span class="s2"> could not be resolved on </span><span class="si">{</span><span class="n">src</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s2">&quot;abstract&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">intermediate</span> <span class="o">==</span> <span class="s1">&#39;only&#39;</span> <span class="k">else</span> <span class="p">[</span><span class="n">DInfo</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attribute </span><span class="si">{</span><span class="n">attr</span><span class="si">!r}</span><span class="s2"> could not be resolved on </span><span class="si">{</span><span class="n">src</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">intermediate</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">info</span><span class="p">],</span> <span class="p">[]</span>
        <span class="n">deps</span><span class="p">,</span> <span class="n">dynamic_deps</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">_spec_to_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dynamic</span><span class="p">,</span> <span class="n">intermediate</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">intermediate</span> <span class="o">!=</span> <span class="s1">&#39;only&#39;</span><span class="p">:</span>
            <span class="n">deps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">deps</span><span class="p">,</span> <span class="n">dynamic_deps</span>

    <span class="k">def</span> <span class="nf">_register_watcher</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">watcher</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">initialized</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s1">&#39;(Un)registering a watcher on a partially initialized Parameterized instance &#39;</span>
                <span class="s1">&#39;is deprecated and will raise an error in a future version. Ensure &#39;</span>
                <span class="s1">&#39;you have called super().__init__(**) in the Parameterized instance &#39;</span>
                <span class="s1">&#39;constructor before trying to set up a watcher.&#39;</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="n">_ParamFutureWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">parameter_names</span> <span class="o">=</span> <span class="n">watcher</span><span class="o">.</span><span class="n">parameter_names</span>
        <span class="k">for</span> <span class="n">parameter_name</span> <span class="ow">in</span> <span class="n">parameter_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parameter_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">param</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> parameter was not found in list of &quot;</span>
                                 <span class="s2">&quot;parameters of class </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parameter_name</span><span class="p">,</span> <span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">what</span> <span class="o">==</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span>
                <span class="n">watchers</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">watchers</span>
                <span class="k">if</span> <span class="n">parameter_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">watchers</span><span class="p">:</span>
                    <span class="n">watchers</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">what</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">watchers</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]:</span>
                    <span class="n">watchers</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">][</span><span class="n">what</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">watchers</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">][</span><span class="n">what</span><span class="p">],</span> <span class="n">action</span><span class="p">)(</span><span class="n">watcher</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">watchers</span> <span class="o">=</span> <span class="n">self_</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span><span class="o">.</span><span class="n">watchers</span>
                <span class="k">if</span> <span class="n">what</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">watchers</span><span class="p">:</span>
                    <span class="n">watchers</span><span class="p">[</span><span class="n">what</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">watchers</span><span class="p">[</span><span class="n">what</span><span class="p">],</span> <span class="n">action</span><span class="p">)(</span><span class="n">watcher</span><span class="p">)</span>

<div class="viewcode-block" id="Parameters.watch"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.watch.html#param.Parameters.watch">[docs]</a>    <span class="k">def</span> <span class="nf">watch</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">parameter_names</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">onlychanged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">queued</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register the given callback function `fn` to be invoked for</span>
<span class="sd">        events on the indicated parameters.</span>

<span class="sd">        `what`: What to watch on each parameter; either the value (by</span>
<span class="sd">        default) or else the indicated slot (e.g. &#39;constant&#39;).</span>

<span class="sd">        `onlychanged`: By default, only invokes the function when the</span>
<span class="sd">        watched item changes, but if `onlychanged=False` also invokes</span>
<span class="sd">        it when the `what` item is set to its current value again.</span>

<span class="sd">        `queued`: By default, additional watcher events generated</span>
<span class="sd">        inside the callback fn are dispatched immediately, effectively</span>
<span class="sd">        doing depth-first processing of Watcher events. However, in</span>
<span class="sd">        certain scenarios, it is helpful to wait to dispatch such</span>
<span class="sd">        downstream events until all events that triggered this watcher</span>
<span class="sd">        have been processed. In such cases setting `queued=True` on</span>
<span class="sd">        this Watcher will queue up new downstream events generated</span>
<span class="sd">        during `fn` until `fn` completes and all other watchers</span>
<span class="sd">        invoked by that same event have finished executing),</span>
<span class="sd">        effectively doing breadth-first processing of Watcher events.</span>

<span class="sd">        `precedence`: Declares a precedence level for the Watcher that</span>
<span class="sd">        determines the priority with which the callback is executed.</span>
<span class="sd">        Lower precedence levels are executed earlier. Negative</span>
<span class="sd">        precedences are reserved for internal Watchers, i.e. those</span>
<span class="sd">        set up by param.depends.</span>

<span class="sd">        When the `fn` is called, it will be provided the relevant</span>
<span class="sd">        Event objects as positional arguments, which allows it to</span>
<span class="sd">        determine which of the possible triggering events occurred.</span>

<span class="sd">        Returns a Watcher object.</span>

<span class="sd">        See help(Watcher) and help(Event) for the contents of those objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">precedence</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;User-defined watch callbacks must declare &quot;</span>
                             <span class="s2">&quot;a positive precedence. Negative precedences &quot;</span>
                             <span class="s2">&quot;are reserved for internal Watchers.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self_</span><span class="o">.</span><span class="n">_watch</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">parameter_names</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="n">onlychanged</span><span class="p">,</span> <span class="n">queued</span><span class="p">,</span> <span class="n">precedence</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_watch</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">parameter_names</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">onlychanged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">queued</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">parameter_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">parameter_names</span><span class="p">,)</span>
        <span class="n">watcher</span> <span class="o">=</span> <span class="n">Watcher</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;args&#39;</span><span class="p">,</span>
                          <span class="n">onlychanged</span><span class="o">=</span><span class="n">onlychanged</span><span class="p">,</span> <span class="n">parameter_names</span><span class="o">=</span><span class="n">parameter_names</span><span class="p">,</span>
                          <span class="n">what</span><span class="o">=</span><span class="n">what</span><span class="p">,</span> <span class="n">queued</span><span class="o">=</span><span class="n">queued</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="n">precedence</span><span class="p">)</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">_register_watcher</span><span class="p">(</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">watcher</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">watcher</span>

<div class="viewcode-block" id="Parameters.unwatch"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.unwatch.html#param.Parameters.unwatch">[docs]</a>    <span class="k">def</span> <span class="nf">unwatch</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">watcher</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the given Watcher object (from `watch` or `watch_values`) from this object&#39;s list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">_register_watcher</span><span class="p">(</span><span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="n">watcher</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="n">watcher</span><span class="o">.</span><span class="n">what</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">self_</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No such watcher </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">watcher</span><span class="p">)</span><span class="si">}</span><span class="s1"> to remove.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.watch_values"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.watch_values.html#param.Parameters.watch_values">[docs]</a>    <span class="k">def</span> <span class="nf">watch_values</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">parameter_names</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">onlychanged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">queued</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Easier-to-use version of `watch` specific to watching for changes in parameter values.</span>

<span class="sd">        Only allows `what` to be &#39;value&#39;, and invokes the callback `fn` using keyword</span>
<span class="sd">        arguments &lt;param_name&gt;=&lt;new_value&gt; rather than with a list of Event objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">precedence</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;User-defined watch callbacks must declare &quot;</span>
                             <span class="s2">&quot;a positive precedence. Negative precedences &quot;</span>
                             <span class="s2">&quot;are reserved for internal Watchers.&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">what</span> <span class="o">==</span> <span class="s1">&#39;value&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">parameter_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parameter_names</span> <span class="o">=</span> <span class="p">(</span><span class="n">parameter_names</span><span class="p">,)</span>
        <span class="n">watcher</span> <span class="o">=</span> <span class="n">Watcher</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">self_</span><span class="o">.</span><span class="n">self</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">self_</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span>
                          <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;kwargs&#39;</span><span class="p">,</span> <span class="n">onlychanged</span><span class="o">=</span><span class="n">onlychanged</span><span class="p">,</span>
                          <span class="n">parameter_names</span><span class="o">=</span><span class="n">parameter_names</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="n">what</span><span class="p">,</span>
                          <span class="n">queued</span><span class="o">=</span><span class="n">queued</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="n">precedence</span><span class="p">)</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">_register_watcher</span><span class="p">(</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">watcher</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">watcher</span></div>

    <span class="c1"># Instance methods</span>

    <span class="c1"># PARAM3_DEPRECATION</span>
<div class="viewcode-block" id="Parameters.defaults"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.defaults.html#param.Parameters.defaults">[docs]</a>    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;Use instead `{k:v.default for k,v in p.param.objects().items()}`&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">defaults</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return {parameter_name:parameter.default} for all non-constant</span>
<span class="sd">        Parameters.</span>

<span class="sd">        Note that a Parameter for which instantiate==True has its default</span>
<span class="sd">        instantiated.</span>

<span class="sd">        .. deprecated:: 1.12.0</span>
<span class="sd">            Use instead `{k:v.default for k,v in p.param.objects().items()}`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">&#39;existing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">instantiate</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_instantiate_param</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">dict_</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">param_name</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span>
        <span class="k">return</span> <span class="n">d</span></div>

    <span class="c1"># Designed to avoid any processing unless the print</span>
    <span class="c1"># level is high enough, though not all callers of message(),</span>
    <span class="c1"># verbose(), debug(), etc are taking advantage of this.</span>
    <span class="k">def</span> <span class="nf">__db_print</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the logger returned by the get_logger() function,</span>
<span class="sd">        prepending the result of calling dbprint_prefix() (if any).</span>

<span class="sd">        See python&#39;s logging module for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_or_cls</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">dbprint_prefix</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">dbprint_prefix</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">dbprint_prefix</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">msg</span>  <span class="c1"># pylint: disable-msg=E1102</span>

            <span class="n">get_logger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="c1"># PARAM3_DEPRECATION</span>
<div class="viewcode-block" id="Parameters.print_param_values"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.print_param_values.html#param.Parameters.print_param_values">[docs]</a>    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Use instead `for k,v in p.param.objects().items(): print(f&quot;</span><span class="si">{p.__class__.name}</span><span class="s2">.</span><span class="si">{k}</span><span class="s2">={repr(v.default)}&quot;)`&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">print_param_values</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the values of all this object&#39;s Parameters.</span>

<span class="sd">        .. deprecated:: 1.12.0</span>
<span class="sd">            Use instead `for k,v in p.param.objects().items(): print(f&quot;{p.__class__.name}.{k}={repr(v.default)}&quot;)`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.warning"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.warning.html#param.Parameters.warning">[docs]</a>    <span class="k">def</span> <span class="nf">warning</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print msg merged with args as a warning, unless module variable</span>
<span class="sd">        warnings_as_exceptions is True, then raise an Exception</span>
<span class="sd">        containing the arguments.</span>

<span class="sd">        See Python&#39;s logging module for details of message formatting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">WARNING</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

    <span class="c1"># PARAM3_DEPRECATION</span>
<div class="viewcode-block" id="Parameters.message"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.message.html#param.Parameters.message">[docs]</a>    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;Use instead `.param.log(param.MESSAGE, ...)`&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print msg merged with args as a message.</span>

<span class="sd">        See Python&#39;s logging module for details of message formatting.</span>

<span class="sd">        .. deprecated:: 1.12.0</span>
<span class="sd">            Use instead `.param.log(param.MESSAGE, ...)`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">__db_print</span><span class="p">(</span><span class="n">INFO</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

    <span class="c1"># PARAM3_DEPRECATION</span>
<div class="viewcode-block" id="Parameters.verbose"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.verbose.html#param.Parameters.verbose">[docs]</a>    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;Use instead `.param.log(param.VERBOSE, ...)`&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">verbose</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print msg merged with args as a verbose message.</span>

<span class="sd">        See Python&#39;s logging module for details of message formatting.</span>

<span class="sd">        .. deprecated:: 1.12.0</span>
<span class="sd">            Use instead `.param.log(param.VERBOSE, ...)`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">__db_print</span><span class="p">(</span><span class="n">VERBOSE</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

    <span class="c1"># PARAM3_DEPRECATION</span>
<div class="viewcode-block" id="Parameters.debug"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.debug.html#param.Parameters.debug">[docs]</a>    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;Use instead `.param.log(param.DEBUG, ...)`&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print msg merged with args as a debugging statement.</span>

<span class="sd">        See Python&#39;s logging module for details of message formatting.</span>

<span class="sd">        .. deprecated:: 1.12.0</span>
<span class="sd">            Use instead `.param.log(param.DEBUG, ...)`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">__db_print</span><span class="p">(</span><span class="n">DEBUG</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.log"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.log.html#param.Parameters.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print msg merged with args as a message at the indicated logging level.</span>

<span class="sd">        Logging levels include those provided by the Python logging module</span>
<span class="sd">        plus VERBOSE, either obtained directly from the logging module like</span>
<span class="sd">        `logging.INFO`, or from parameterized like `param.parameterized.INFO`.</span>

<span class="sd">        Supported logging levels include (in order of severity)</span>
<span class="sd">        DEBUG, VERBOSE, INFO, WARNING, ERROR, CRITICAL</span>

<span class="sd">        See Python&#39;s logging module for details of message formatting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="n">WARNING</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">warnings_as_exceptions</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Warning: &quot;</span> <span class="o">+</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">global</span> <span class="n">warning_count</span>
                <span class="n">warning_count</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">self_</span><span class="o">.</span><span class="n">__db_print</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

    <span class="c1"># Note that there&#39;s no _state_push method on the class, so</span>
    <span class="c1"># dynamic parameters set on a class can&#39;t have state saved. This</span>
    <span class="c1"># is because, to do this, _state_push() would need to be a</span>
    <span class="c1"># @bothmethod, but that complicates inheritance in cases where we</span>
    <span class="c1"># already have a _state_push() method.</span>
    <span class="c1"># (isinstance(g,Parameterized) below is used to exclude classes.)</span>

    <span class="k">def</span> <span class="nf">_state_push</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save this instance&#39;s state.</span>

<span class="sd">        For Parameterized instances, this includes the state of</span>
<span class="sd">        dynamically generated values.</span>

<span class="sd">        Subclasses that maintain short-term state should additionally</span>
<span class="sd">        save and restore that state using _state_push() and</span>
<span class="sd">        _state_pop().</span>

<span class="sd">        Generally, this method is used by operations that need to test</span>
<span class="sd">        something without permanently altering the objects&#39; state.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;_state_push is not implemented at the class level&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pname</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">&#39;existing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_value_generator</span><span class="p">(</span><span class="n">pname</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="s1">&#39;_Dynamic_last&#39;</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">_saved_Dynamic_last</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">_Dynamic_last</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">_saved_Dynamic_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">_Dynamic_time</span><span class="p">)</span>
                <span class="c1"># CB: not storing the time_fn: assuming that doesn&#39;t</span>
                <span class="c1"># change.</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="s1">&#39;_state_push&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">Parameterized</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">_state_push</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_state_pop</span><span class="p">(</span><span class="n">self_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore the most recently saved state.</span>

<span class="sd">        See _state_push() for more details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;_state_pop is not implemented at the class level&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pname</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">&#39;existing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_value_generator</span><span class="p">(</span><span class="n">pname</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="s1">&#39;_Dynamic_last&#39;</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">_Dynamic_last</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">_saved_Dynamic_last</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">g</span><span class="o">.</span><span class="n">_Dynamic_time</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">_saved_Dynamic_time</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="s1">&#39;_state_pop&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">Parameterized</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">_state_pop</span><span class="p">()</span>

<div class="viewcode-block" id="Parameters.pprint"><a class="viewcode-back" href="../../reference/param/generated/param.parameterized.Parameters.pprint.html#param.Parameters.pprint">[docs]</a>    <span class="k">def</span> <span class="nf">pprint</span><span class="p">(</span><span class="n">self_</span><span class="p">,</span> <span class="n">imports</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=</span><span class="s1">&#39;&lt;?&gt;&#39;</span><span class="p">,</span>
               <span class="n">qualify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (Experimental) Pretty printed representation that may be</span>
<span class="sd">        evaluated with eval. See pprint() function for more details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">self_</span><span class="o">.</span><span class="n">self_or_cls</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;pprint is not implemented at the class level&#39;</span><span class="p">)</span>
        <span class="c1"># Wrapping the staticmethod _pprint with partial to pass `self` as the `_recursive_repr`</span>
        <span class="c1"># decorator expects `self`` to be the pprinted object (not `self_`).</span>
        <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="n">_pprint</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">imports</span><span class="o">=</span><span class="n">imports</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span>
                       <span class="n">unknown_value</span><span class="o">=</span><span class="n">unknown_value</span><span class="p">,</span> <span class="n">qualify</span><span class="o">=</span><span class="n">qualify</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="n">separator</span><span class="p">)()</span></div>

    <span class="nd">@staticmethod</span>
    <span class="nd">@_recursive_repr</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_pprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imports</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=</span><span class="s1">&#39;&lt;?&gt;&#39;</span><span class="p">,</span>
               <span class="n">qualify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">imports</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">imports</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># would have been simpler to use a set from the start</span>
        <span class="n">imports</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">imports</span><span class="p">))</span>

        <span class="c1"># Generate import statement</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;import </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;import </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">changed_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">onlychanged</span><span class="o">=</span><span class="n">script_repr_suppress_defaults</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">getfullargspec</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;self&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">args</span> <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;self&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.__init__.__signature__&#39; must contain &#39;self&#39; as its first Parameter.&quot;</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">posargs</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">defaults</span><span class="p">)]</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">defaults</span><span class="p">):],</span> <span class="n">spec</span><span class="o">.</span><span class="n">defaults</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">posargs</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">args</span><span class="p">,</span> <span class="p">[]</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="s1">&#39;existing&#39;</span><span class="p">)</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">changed_params</span><span class="p">),</span> <span class="c1"># alphanumeric tie-breaker</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>  <span class="c1"># No precedence is lowest possible precendence</span>
                           <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">precedence</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span>
                           <span class="n">parameters</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">precedence</span><span class="p">))</span>

        <span class="n">arglist</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">processed</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">args</span> <span class="o">+</span> <span class="n">ordering</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">processed</span><span class="p">:</span> <span class="k">continue</span>

            <span class="c1"># Suppresses automatically generated names.</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;[0-9]+$&#39;</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">])):</span>
                <span class="k">continue</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">pprint</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">imports</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="o">=</span><span class="p">[],</span>
                           <span class="n">unknown_value</span><span class="o">=</span><span class="n">unknown_value</span><span class="p">,</span>
                           <span class="n">qualify</span><span class="o">=</span><span class="n">qualify</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">unknown_value</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: unknown value of </span><span class="si">{</span><span class="n">k</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">unknown_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># i.e. suppress repr</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">unknown_value</span>

            <span class="c1"># Explicit kwarg (unchanged, known value)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span> <span class="k">continue</span>

            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">posargs</span><span class="p">:</span>
                <span class="c1"># value will be unknown_value unless k is a parameter</span>
                <span class="n">arglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span>
                  <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="s1">&#39;varkw&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">varkw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">or</span>
                  <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="s1">&#39;keywords&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">keywords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))):</span>
                <span class="c1"># Explicit modified keywords or parameters in</span>
                <span class="c1"># precendence order (if **kwargs present)</span>
                <span class="n">keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">processed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="n">qualifier</span> <span class="o">=</span> <span class="n">mod</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>  <span class="k">if</span> <span class="n">qualify</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="n">arglist</span> <span class="o">+</span> <span class="n">keywords</span> <span class="o">+</span> <span class="p">([</span><span class="s1">&#39;**</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">spec</span><span class="o">.</span><span class="n">varargs</span><span class="p">]</span> <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">varargs</span> <span class="k">else</span> <span class="p">[])</span>
        <span class="k">return</span> <span class="n">qualifier</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>  <span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="n">separator</span><span class="o">+</span><span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arguments</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">ParameterizedMetaclass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The metaclass of Parameterized (and all its descendents).</span>

<span class="sd">    The metaclass overrides type.__setattr__ to allow us to set</span>
<span class="sd">    Parameter values on classes without overwriting the attribute</span>
<span class="sd">    descriptor.  That is, for a Parameterized class of type X with a</span>
<span class="sd">    Parameter y, the user can type X.y=3, which sets the default value</span>
<span class="sd">    of Parameter y to be 3, rather than overwriting y with the</span>
<span class="sd">    constant value 3 (and thereby losing all other info about that</span>
<span class="sd">    Parameter, such as the doc string, bounds, etc.).</span>

<span class="sd">    The __init__ method is used when defining a Parameterized class,</span>
<span class="sd">    usually when the module where that class is located is imported</span>
<span class="sd">    for the first time.  That is, the __init__ in this metaclass</span>
<span class="sd">    initializes the *class* object, while the __init__ method defined</span>
<span class="sd">    in each Parameterized class is called for each new instance of</span>
<span class="sd">    that class.</span>

<span class="sd">    Additionally, a class can declare itself abstract by having an</span>
<span class="sd">    attribute __abstract set to True. The &#39;abstract&#39; attribute can be</span>
<span class="sd">    used to find out if a class is abstract or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dict_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the class object (not an instance of the class, but</span>
<span class="sd">        the class itself).</span>

<span class="sd">        Initializes all the Parameters by looking up appropriate</span>
<span class="sd">        default values (see __param_inheritance()) and setting</span>
<span class="sd">        attrib_names (see _set_names()).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">type</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dict_</span><span class="p">)</span>

        <span class="c1"># Compute which parameters explicitly do not support references</span>
        <span class="c1"># This can be removed when Parameter.allow_refs=True by default.</span>
        <span class="n">explicit_no_refs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">):</span>
                <span class="n">explicit_no_refs</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">explicit_no_refs</span><span class="p">)</span>

        <span class="n">_param__private</span> <span class="o">=</span> <span class="n">_ClassPrivate</span><span class="p">(</span><span class="n">explicit_no_refs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">explicit_no_refs</span><span class="p">))</span>
        <span class="n">mcs</span><span class="o">.</span><span class="n">_param__private</span> <span class="o">=</span> <span class="n">_param__private</span>
        <span class="n">mcs</span><span class="o">.</span><span class="n">__set_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dict_</span><span class="p">)</span>
        <span class="n">mcs</span><span class="o">.</span><span class="n">_param__parameters</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span><span class="n">mcs</span><span class="p">)</span>

        <span class="c1"># All objects (with their names) of type Parameter that are</span>
        <span class="c1"># defined in this class</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dict_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span><span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">mcs</span><span class="o">.</span><span class="n">_initialize_parameter</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

        <span class="c1"># retrieve depends info from methods and store more conveniently</span>
        <span class="n">dependers</span> <span class="o">=</span> <span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">_dinfo</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dict_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                     <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s1">&#39;_dinfo&#39;</span><span class="p">)]</span>

        <span class="c1"># Resolve dependencies of current class</span>
        <span class="n">_watch</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">dinfo</span> <span class="ow">in</span> <span class="n">dependers</span><span class="p">:</span>
            <span class="n">watch</span> <span class="o">=</span> <span class="n">dinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;watch&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">on_init</span> <span class="o">=</span> <span class="n">dinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;on_init&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">minfo</span> <span class="o">=</span> <span class="n">MInfo</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">mcs</span><span class="p">,</span> <span class="n">inst</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                          <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="n">deps</span><span class="p">,</span> <span class="n">dynamic_deps</span> <span class="o">=</span> <span class="n">_params_depended_on</span><span class="p">(</span><span class="n">minfo</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">watch</span><span class="p">:</span>
                <span class="n">_watch</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">watch</span> <span class="o">==</span> <span class="s1">&#39;queued&#39;</span><span class="p">,</span> <span class="n">on_init</span><span class="p">,</span> <span class="n">deps</span><span class="p">,</span> <span class="n">dynamic_deps</span><span class="p">))</span>

        <span class="c1"># Resolve dependencies in class hierarchy</span>
        <span class="n">_inherited</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">classlist</span><span class="p">(</span><span class="n">mcs</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;_param__parameters&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_depends</span><span class="p">[</span><span class="s1">&#39;watch&#39;</span><span class="p">]:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">dep</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">dinfo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s1">&#39;_dinfo&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;watch&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">_watch</span><span class="o">+</span><span class="n">_inherited</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">dinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;watch&#39;</span><span class="p">)):</span>
                    <span class="n">_inherited</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span>

        <span class="n">mcs</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_depends</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;watch&#39;</span><span class="p">:</span> <span class="n">_inherited</span><span class="o">+</span><span class="n">_watch</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">docstring_signature</span><span class="p">:</span>
            <span class="n">mcs</span><span class="o">.</span><span class="n">__class_docstring</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__set_name</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dict_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Give Parameterized classes a useful &#39;name&#39; attribute that is by</span>
<span class="sd">        default the class name, unless a class in the hierarchy has defined</span>
<span class="sd">        a `name` String Parameter with a defined `default` value, in which case</span>
<span class="sd">        that value is used to set the class name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name_param</span> <span class="o">=</span> <span class="n">dict_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">name_param</span><span class="p">)</span> <span class="ow">is</span> <span class="n">String</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Parameterized class </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2"> cannot override &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;the &#39;name&#39; Parameter with type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">name_param</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
                    <span class="s2">&quot;Overriding &#39;name&#39; is only allowed with a &#39;String&#39; Parameter.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">name_param</span><span class="o">.</span><span class="n">default</span><span class="p">:</span>
                <span class="n">mcs</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name_param</span><span class="o">.</span><span class="n">default</span>
                <span class="n">mcs</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">renamed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mcs</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="n">classlist</span><span class="p">(</span><span class="n">mcs</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">found_renamed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;_param__private&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">renamed</span><span class="p">:</span>
                    <span class="n">found_renamed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found_renamed</span><span class="p">:</span>
                <span class="n">mcs</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">__class_docstring</span><span class="p">(</span><span class="n">mcs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Customize the class docstring with a Parameter table if</span>
<span class="sd">        `docstring_describe_params` and the `param_pager` is available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">docstring_describe_params</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">param_pager</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">class_docstr</span> <span class="o">=</span> <span class="n">mcs</span><span class="o">.</span><span class="vm">__doc__</span> <span class="k">if</span> <span class="n">mcs</span><span class="o">.</span><span class="vm">__doc__</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">param_pager</span><span class="p">(</span><span class="n">mcs</span><span class="p">)</span>
        <span class="n">mcs</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">class_docstr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">description</span>

    <span class="k">def</span> <span class="nf">_initialize_parameter</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="c1"># A Parameter has no way to find out the name a</span>
        <span class="c1"># Parameterized class has for it</span>
        <span class="n">param</span><span class="o">.</span><span class="n">_set_names</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span>
        <span class="n">mcs</span><span class="o">.</span><span class="n">__param_inheritance</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

    <span class="c1"># Should use the official Python 2.6+ abstract base classes; see</span>
    <span class="c1"># https://github.com/holoviz/param/issues/84</span>
    <span class="k">def</span> <span class="nf">__is_abstract</span><span class="p">(</span><span class="n">mcs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if the class has an attribute __abstract set to True.</span>
<span class="sd">        Subclasses will return False unless they themselves have</span>
<span class="sd">        __abstract set to true.  This mechanism allows a class to</span>
<span class="sd">        declare itself to be abstract (e.g. to avoid it being offered</span>
<span class="sd">        as an option in a GUI), without the &quot;abstract&quot; property being</span>
<span class="sd">        inherited by its subclasses (at least one of which is</span>
<span class="sd">        presumably not abstract).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can&#39;t just do &quot;.__abstract&quot;, because that is mangled to</span>
        <span class="c1"># _ParameterizedMetaclass__abstract before running, but</span>
        <span class="c1"># the actual class object will have an attribute</span>
        <span class="c1"># _ClassName__abstract.  So, we have to mangle it ourselves at</span>
        <span class="c1"># runtime. Mangling follows description in</span>
        <span class="c1"># https://docs.python.org/2/tutorial/classes.html#private-variables-and-class-local-references</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">__abstract&#39;</span><span class="o">%</span><span class="n">mcs</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__get_signature</span><span class="p">(</span><span class="n">mcs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For classes with a constructor signature that matches the default</span>
<span class="sd">        Parameterized.__init__ signature (i.e. ``__init__(self, **params)``)</span>
<span class="sd">        this method will generate a new signature that expands the</span>
<span class="sd">        parameters. If the signature differs from the default the</span>
<span class="sd">        custom signature is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mcs</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">signature</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mcs</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">signature</span>
        <span class="c1"># allowed_signature must be the signature of Parameterized.__init__</span>
        <span class="c1"># Inspecting `mcs.__init__` instead of `mcs` to avoid a recursion error</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">mcs</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span> <span class="o">!=</span> <span class="n">DEFAULT_SIGNATURE</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">processed_kws</span><span class="p">,</span> <span class="n">keyword_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">mcs</span><span class="o">.</span><span class="n">mro</span><span class="p">()):</span>
            <span class="n">keyword_group</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">processed_kws</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
                    <span class="n">keyword_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">processed_kws</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">keyword_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">keyword_group</span><span class="p">)</span>

        <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">grp</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">keyword_groups</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">grp</span><span class="p">]</span>
        <span class="n">mcs</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Signature</span><span class="p">([</span>
            <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">KEYWORD_ONLY</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keywords</span>
        <span class="p">])</span>
        <span class="k">return</span> <span class="n">signature</span>

    <span class="n">__signature__</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">__get_signature</span><span class="p">)</span>

    <span class="n">abstract</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">__is_abstract</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_param</span><span class="p">(</span><span class="n">mcs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mcs</span><span class="o">.</span><span class="n">_param__parameters</span>

    <span class="n">param</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_param</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements &#39;self.attribute_name=value&#39; in a way that also supports Parameters.</span>

<span class="sd">        If there is already a descriptor named attribute_name, and</span>
<span class="sd">        that descriptor is a Parameter, and the new value is *not* a</span>
<span class="sd">        Parameter, then call that Parameter&#39;s __set__ method with the</span>
<span class="sd">        specified value.</span>

<span class="sd">        In all other cases set the attribute normally (i.e. overwrite</span>
<span class="sd">        the descriptor).  If the new value is a Parameter, once it has</span>
<span class="sd">        been set we make sure that the value is inherited from</span>
<span class="sd">        Parameterized superclasses as described in __param_inheritance().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find out if there&#39;s a Parameter called attribute_name as a</span>
        <span class="c1"># class attribute of this class - if not, parameter is None.</span>
        <span class="n">parameter</span><span class="p">,</span><span class="n">owning_class</span> <span class="o">=</span> <span class="n">mcs</span><span class="o">.</span><span class="n">get_param_descriptor</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parameter</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">Parameter</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">owning_class</span> <span class="o">!=</span> <span class="n">mcs</span><span class="p">:</span>
                <span class="n">parameter</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
                <span class="n">parameter</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">mcs</span>
                <span class="nb">type</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">attribute_name</span><span class="p">,</span><span class="n">parameter</span><span class="p">)</span>
            <span class="n">mcs</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">type</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">attribute_name</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">Parameter</span><span class="p">):</span>
                <span class="n">mcs</span><span class="o">.</span><span class="n">__param_inheritance</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__param_inheritance</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Look for Parameter values in superclasses of this</span>
<span class="sd">        Parameterized class.</span>

<span class="sd">        Ordinarily, when a Python object is instantiated, attributes</span>
<span class="sd">        not given values in the constructor will inherit the value</span>
<span class="sd">        given in the object&#39;s class, or in its superclasses.  For</span>
<span class="sd">        Parameters owned by Parameterized classes, we have implemented</span>
<span class="sd">        an additional level of default lookup, should this ordinary</span>
<span class="sd">        lookup return only `Undefined`.</span>

<span class="sd">        In such a case, i.e. when no non-`Undefined` value was found for a</span>
<span class="sd">        Parameter by the usual inheritance mechanisms, we explicitly</span>
<span class="sd">        look for Parameters with the same name in superclasses of this</span>
<span class="sd">        Parameterized class, and use the first such value that we</span>
<span class="sd">        find.</span>

<span class="sd">        The goal is to be able to set the default value (or other</span>
<span class="sd">        slots) of a Parameter within a Parameterized class, just as we</span>
<span class="sd">        can set values for non-Parameter objects in Parameterized</span>
<span class="sd">        classes, and have the values inherited through the</span>
<span class="sd">        Parameterized hierarchy as usual.</span>

<span class="sd">        Note that instantiate is handled differently: if there is a</span>
<span class="sd">        parameter with the same name in one of the superclasses with</span>
<span class="sd">        instantiate set to True, this parameter will inherit</span>
<span class="sd">        instantiate=True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get all relevant slots (i.e. slots defined in all</span>
        <span class="c1"># superclasses of this parameter)</span>
        <span class="n">p_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">p_type</span><span class="o">.</span><span class="n">_all_slots_</span><span class="p">)</span>

        <span class="c1"># note for some eventual future: python 3.6+ descriptors grew</span>
        <span class="c1"># __set_name__, which could replace this and _set_names</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="n">mcs</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">slots</span><span class="p">[</span><span class="s1">&#39;owner&#39;</span><span class="p">]</span>

        <span class="c1"># backwards compatibility (see Composite parameter)</span>
        <span class="k">if</span> <span class="s1">&#39;objtype&#39;</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="s1">&#39;objtype&#39;</span><span class="p">,</span> <span class="n">mcs</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">slots</span><span class="p">[</span><span class="s1">&#39;objtype&#39;</span><span class="p">]</span>

        <span class="n">supers</span> <span class="o">=</span> <span class="n">classlist</span><span class="p">(</span><span class="n">mcs</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Explicitly inherit instantiate from super class and</span>
        <span class="c1"># check if type has changed to a more specific or different</span>
        <span class="c1"># Parameter type, requiring extra validation</span>
        <span class="n">type_change</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">superclass</span> <span class="ow">in</span> <span class="n">supers</span><span class="p">:</span>
            <span class="n">super_param</span> <span class="o">=</span> <span class="n">superclass</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">super_param</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">super_param</span><span class="o">.</span><span class="n">instantiate</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">param</span><span class="o">.</span><span class="n">instantiate</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">super_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">super_param</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">super_type</span><span class="p">,</span> <span class="n">p_type</span><span class="p">):</span>
                <span class="n">type_change</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">del</span> <span class="n">slots</span><span class="p">[</span><span class="s1">&#39;instantiate&#39;</span><span class="p">]</span>

        <span class="n">callables</span><span class="p">,</span> <span class="n">slot_values</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
        <span class="n">slot_overridden</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">slots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Search up the hierarchy until param.slot (which has to</span>
            <span class="c1"># be obtained using getattr(param,slot)) is not Undefined,</span>
            <span class="c1"># is a new value (using identity) or we run out of classes</span>
            <span class="c1"># to search.</span>
            <span class="k">for</span> <span class="n">scls</span> <span class="ow">in</span> <span class="n">supers</span><span class="p">:</span>
                <span class="c1"># Class may not define parameter or slot might not be</span>
                <span class="c1"># there because could be a more general type of Parameter</span>
                <span class="n">new_param</span> <span class="o">=</span> <span class="n">scls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_param</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_param</span><span class="p">,</span> <span class="n">slot</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">new_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_param</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>
                <span class="n">old_value</span> <span class="o">=</span> <span class="n">slot_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slot</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_value</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">new_value</span> <span class="ow">is</span> <span class="n">old_value</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">old_value</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
                    <span class="n">slot_values</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_value</span>
                    <span class="c1"># If we already know we have to re-validate abort</span>
                    <span class="c1"># early to avoid costly lookups</span>
                    <span class="k">if</span> <span class="n">slot_overridden</span> <span class="ow">or</span> <span class="n">type_change</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">slot</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">param</span><span class="o">.</span><span class="n">_non_validated_slots</span><span class="p">:</span>
                        <span class="n">slot_overridden</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">slot_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slot</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">default_val</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">_slot_defaults</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Slot </span><span class="si">{</span><span class="n">slot</span><span class="si">!r}</span><span class="s1"> of parameter </span><span class="si">{</span><span class="n">param_name</span><span class="si">!r}</span><span class="s1"> has no &#39;</span>
                        <span class="s1">&#39;default value defined in `_slot_defaults`&#39;</span>
                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">default_val</span><span class="p">):</span>
                    <span class="n">callables</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_val</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">slot_values</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_val</span>
            <span class="k">elif</span> <span class="n">slot</span> <span class="o">==</span> <span class="s1">&#39;allow_refs&#39;</span><span class="p">:</span>
                <span class="c1"># Track Parameters that explicitly declared no refs</span>
                <span class="n">explicit_no_refs</span> <span class="o">=</span> <span class="n">mcs</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">explicit_no_refs</span>
                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">allow_refs</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">explicit_no_refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">allow_refs</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">explicit_no_refs</span><span class="p">:</span>
                    <span class="n">explicit_no_refs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Now set the actual slot values</span>
        <span class="k">for</span> <span class="n">slot</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">slot_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="c1"># Avoid crosstalk between mutable slot values in different Parameter objects</span>
            <span class="k">if</span> <span class="n">slot</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_is_mutable_container</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

        <span class="c1"># Once all the static slots have been filled in, fill in the dynamic ones</span>
        <span class="c1"># (which are only allowed to use static values or results are undefined)</span>
        <span class="k">for</span> <span class="n">slot</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">callables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">fn</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>

        <span class="c1"># Once all the slot values have been set, call _update_state for Parameters</span>
        <span class="c1"># that need updates to make sure they&#39;re set up correctly after inheritance.</span>
        <span class="n">param</span><span class="o">.</span><span class="n">_update_state</span><span class="p">()</span>

        <span class="c1"># If the type has changed to a more specific or different type</span>
        <span class="c1"># or a slot value has been changed validate the default again.</span>

        <span class="c1"># Hack: Had to disable re-validation of None values because the</span>
        <span class="c1"># automatic appending of an unknown value on Selector opens a whole</span>
        <span class="c1"># rabbit hole in regard to the validation.</span>
        <span class="k">if</span> <span class="n">type_change</span> <span class="ow">or</span> <span class="n">slot_overridden</span> <span class="ow">and</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">param</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
            <span class="c1"># Param has no base validation exception class. Param Parameters raise</span>
            <span class="c1"># ValueError, TypeError, OSError exceptions but external Parameters</span>
            <span class="c1"># might raise other types of error, so we catch them all.</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_validate_error_prefix</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="si">}</span><span class="s1"> failed to validate its &#39;</span> \
                      <span class="s1">&#39;default value on class creation, this is going to raise &#39;</span> \
                      <span class="s1">&#39;an error in the future. &#39;</span>
                <span class="n">parents</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="n">mcs</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">type_change</span> <span class="ow">and</span> <span class="n">slot_overridden</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;The Parameter is defined with attributes which when &#39;</span>
                        <span class="s1">&#39;combined with attributes inherited from its parent &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;classes (</span><span class="si">{</span><span class="n">parents</span><span class="si">}</span><span class="s1">) make it invalid. &#39;</span>
                        <span class="s1">&#39;Please fix the Parameter attributes.&#39;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">type_change</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">slot_overridden</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;The Parameter type changed between class </span><span class="si">{</span><span class="n">mcs</span><span class="o">.</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s1"> &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;and one of its parent classes (</span><span class="si">{</span><span class="n">parents</span><span class="si">}</span><span class="s1">) which &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;made it invalid. Please fix the Parameter type.&#39;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># type_change and slot_overriden is not possible as when</span>
                    <span class="c1"># the type changes checking the slots is aborted for</span>
                    <span class="c1"># performance reasons.</span>
                    <span class="k">pass</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Validation failed with:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="n">msg</span><span class="p">,</span>
                    <span class="n">category</span><span class="o">=</span><span class="n">_ParamFutureWarning</span><span class="p">,</span>
                    <span class="n">stacklevel</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_param_descriptor</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span><span class="n">param_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Goes up the class hierarchy (starting from the current class)</span>
<span class="sd">        looking for a Parameter class attribute param_name. As soon as</span>
<span class="sd">        one is found as a class attribute, that Parameter is returned</span>
<span class="sd">        along with the class in which it is declared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="n">classlist</span><span class="p">(</span><span class="n">mcs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span><span class="n">Parameter</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">attribute</span><span class="p">,</span><span class="n">c</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span>



<span class="c1"># Whether script_repr should avoid reporting the values of parameters</span>
<span class="c1"># that are just inheriting their values from the class defaults.</span>
<span class="c1"># Because deepcopying creates a new object, cannot detect such</span>
<span class="c1"># inheritance when instantiate = True, so such values will be printed</span>
<span class="c1"># even if they are just being copied from the default.</span>
<span class="n">script_repr_suppress_defaults</span><span class="o">=</span><span class="kc">True</span>


<div class="viewcode-block" id="script_repr"><a class="viewcode-back" href="../../reference/param/generated/param.script_repr.html#param.script_repr">[docs]</a><span class="k">def</span> <span class="nf">script_repr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">imports</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    &quot;</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">qualify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">show_imports</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Variant of pprint() designed for generating a (nearly) runnable script.</span>

<span class="sd">    The output of script_repr(parameterized_obj) is meant to be a</span>
<span class="sd">    string suitable for running using `python file.py`. Not every</span>
<span class="sd">    object is guaranteed to have a runnable script_repr</span>
<span class="sd">    representation, but it is meant to be a good starting point for</span>
<span class="sd">    generating a Python script that (after minor edits) can be</span>
<span class="sd">    evaluated to get a newly initialized object similar to the one</span>
<span class="sd">    provided.</span>

<span class="sd">    The new object will only have the same parameter state, not the</span>
<span class="sd">    same internal (attribute) state; the script_repr captures only</span>
<span class="sd">    the state of the Parameters of that object and not any other</span>
<span class="sd">    attributes it may have.</span>

<span class="sd">    If show_imports is True (default), includes import statements</span>
<span class="sd">    for each of the modules required for the objects being</span>
<span class="sd">    instantiated. This list may not be complete, as it typically</span>
<span class="sd">    includes only the imports needed for the Parameterized object</span>
<span class="sd">    itself, not for values that may have been supplied to Parameters.</span>

<span class="sd">    Apart from show_imports, accepts the same arguments as pprint(),</span>
<span class="sd">    so see pprint() for explanations of the arguments accepted. The</span>
<span class="sd">    default values of each of these arguments differ from pprint() in</span>
<span class="sd">    ways that are more suitable for saving as a separate script than</span>
<span class="sd">    for e.g. pretty-printing at the Python prompt.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">imports</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">imports</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">rep</span> <span class="o">=</span> <span class="n">pprint</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">imports</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">unknown_value</span><span class="p">,</span>
                 <span class="n">qualify</span><span class="p">,</span> <span class="n">separator</span><span class="p">)</span>

    <span class="n">imports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">imports</span><span class="p">))</span>
    <span class="n">imports_str</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">imports</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">show_imports</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">return</span> <span class="n">imports_str</span> <span class="o">+</span> <span class="n">rep</span></div>


<span class="c1"># PARAM2_DEPRECATION: Remove entirely unused settings argument</span>
<span class="k">def</span> <span class="nf">pprint</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">imports</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    &quot;</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">[],</span>
           <span class="n">unknown_value</span><span class="o">=</span><span class="s1">&#39;&lt;?&gt;&#39;</span><span class="p">,</span> <span class="n">qualify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pretty printed representation of a parameterized</span>
<span class="sd">    object that may be evaluated with eval.</span>

<span class="sd">    Similar to repr except introspection of the constructor (__init__)</span>
<span class="sd">    ensures a valid and succinct representation is generated.</span>

<span class="sd">    Only parameters are represented (whether specified as standard,</span>
<span class="sd">    positional, or keyword arguments). Parameters specified as</span>
<span class="sd">    positional arguments are always shown, followed by modified</span>
<span class="sd">    parameters specified as keyword arguments, sorted by precedence.</span>

<span class="sd">    unknown_value determines what to do where a representation cannot be</span>
<span class="sd">    generated for something required to recreate the object. Such things</span>
<span class="sd">    include non-parameter positional and keyword arguments, and certain</span>
<span class="sd">    values of parameters (e.g. some random state objects).</span>

<span class="sd">    Supplying an unknown_value of None causes unrepresentable things</span>
<span class="sd">    to be silently ignored. If unknown_value is a string, that</span>
<span class="sd">    string will appear in place of any unrepresentable things. If</span>
<span class="sd">    unknown_value is False, an Exception will be raised if an</span>
<span class="sd">    unrepresentable value is encountered.</span>

<span class="sd">    If supplied, imports should be a list, and it will be populated</span>
<span class="sd">    with the set of imports required for the object and all of its</span>
<span class="sd">    parameter values.</span>

<span class="sd">    If qualify is True, the class&#39;s path will be included (e.g. &quot;a.b.C()&quot;),</span>
<span class="sd">    otherwise only the class will appear (&quot;C()&quot;).</span>

<span class="sd">    Parameters will be separated by a comma only by default, but the</span>
<span class="sd">    separator parameter allows an additional separator to be supplied</span>
<span class="sd">    (e.g. a newline could be supplied to have each Parameter appear on a</span>
<span class="sd">    separate line).</span>

<span class="sd">    Instances of types that require special handling can use the</span>
<span class="sd">    script_repr_reg dictionary. Using the type as a key, add a</span>
<span class="sd">    function that returns a suitable representation of instances of</span>
<span class="sd">    that type, and adds the required import statement. The repr of a</span>
<span class="sd">    parameter can be suppressed by returning None from the appropriate</span>
<span class="sd">    hook in script_repr_reg.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">imports</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">imports</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="n">type_script_repr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">script_repr_reg</span><span class="p">:</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="n">script_repr_reg</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)](</span><span class="n">val</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">)):</span>
        <span class="n">rep</span><span class="o">=</span><span class="n">val</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">imports</span><span class="o">=</span><span class="n">imports</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;    &quot;</span><span class="p">,</span>
                        <span class="n">qualify</span><span class="o">=</span><span class="n">qualify</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=</span><span class="n">unknown_value</span><span class="p">,</span>
                        <span class="n">separator</span><span class="o">=</span><span class="n">separator</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rep</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rep</span>


<span class="c1"># Registry for special handling for certain types in script_repr and pprint</span>
<span class="n">script_repr_reg</span> <span class="o">=</span> <span class="p">{}</span>


<span class="c1"># currently only handles list and tuple</span>
<span class="k">def</span> <span class="nf">container_script_repr</span><span class="p">(</span><span class="n">container</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">):</span>
    <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">container</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pprint</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">))</span>

    <span class="c1">## (hack to get container brackets)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">container</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="o">=</span><span class="s1">&#39;[&#39;</span><span class="p">,</span><span class="s1">&#39;]&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">container</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span>
        <span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="o">=</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;)&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="n">rep</span><span class="o">=</span><span class="n">d1</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">+</span><span class="n">d2</span>

    <span class="c1"># no imports to add for built-in types</span>

    <span class="k">return</span> <span class="n">rep</span>


<span class="k">def</span> <span class="nf">empty_script_repr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span> <span class="c1"># pyflakes:ignore (unused arguments):</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Suppress scriptrepr for objects not yet having a useful string representation</span>
    <span class="kn">import</span> <span class="nn">numpy</span>
    <span class="n">script_repr_reg</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty_script_repr</span>
    <span class="n">script_repr_reg</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty_script_repr</span>

<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c1"># Support added only if those libraries are available</span>


<span class="k">def</span> <span class="nf">function_script_repr</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__module__</span>
    <span class="n">imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;import </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">module</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">module</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">name</span>

<span class="k">def</span> <span class="nf">type_script_repr</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">settings</span><span class="p">):</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">type_</span><span class="o">.</span><span class="vm">__module__</span>
    <span class="k">if</span> <span class="n">module</span><span class="o">!=</span><span class="s1">&#39;__builtin__&#39;</span><span class="p">:</span>
        <span class="n">imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;import </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">module</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">module</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">type_</span><span class="o">.</span><span class="vm">__name__</span>

<span class="n">script_repr_reg</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="n">container_script_repr</span>
<span class="n">script_repr_reg</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="n">container_script_repr</span>
<span class="n">script_repr_reg</span><span class="p">[</span><span class="n">FunctionType</span><span class="p">]</span> <span class="o">=</span> <span class="n">function_script_repr</span>


<span class="c1">#: If not None, the value of this Parameter will be called (using &#39;()&#39;)</span>
<span class="c1">#: before every call to __db_print, and is expected to evaluate to a</span>
<span class="c1">#: string that is suitable for prefixing messages and warnings (such</span>
<span class="c1">#: as some indicator of the global state).</span>
<span class="n">dbprint_prefix</span><span class="o">=</span><span class="kc">None</span>


<span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">maxlen</span> <span class="o">=</span> <span class="mi">30</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return HTML-safe truncated version of given string&quot;&quot;&quot;</span>
    <span class="n">rep</span> <span class="o">=</span> <span class="p">(</span><span class="n">str_</span><span class="p">[:(</span><span class="n">maxlen</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span> <span class="o">+</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">str_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">maxlen</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="k">else</span> <span class="n">str_</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">rep</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_param_repr</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vallen</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">doclen</span><span class="o">=</span><span class="mi">40</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;HTML representation for a single Parameter object and its value&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">)):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">(</span><span class="nb">open</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">&quot;_repr_html_&quot;</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">truncate</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">vallen</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;bounds&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">range_</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s1">&#39;inclusive_bounds&#39;</span><span class="p">):</span>
            <span class="c1"># Numeric bounds use ( and [ to indicate exclusive and inclusive</span>
            <span class="n">bl</span><span class="p">,</span><span class="n">bu</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">bounds</span>
            <span class="n">il</span><span class="p">,</span><span class="n">iu</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">inclusive_bounds</span>

            <span class="n">lb</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">bl</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;&gt;=&#39;</span> <span class="k">if</span> <span class="n">il</span> <span class="k">else</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bl</span><span class="p">)</span>
            <span class="n">ub</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">bu</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span> <span class="k">if</span> <span class="n">iu</span> <span class="k">else</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bu</span><span class="p">)</span>
            <span class="n">range_</span> <span class="o">=</span> <span class="n">lb</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;, &#39;</span> <span class="k">if</span> <span class="n">lb</span> <span class="ow">and</span> <span class="n">bu</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">ub</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">range_</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;objects&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
        <span class="n">range_</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">objects</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;class_&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">class_</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">range_</span> <span class="o">=</span> <span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kls</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">kls</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">class_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">range_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">class_</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;regex&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">regex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">range_</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;regex(</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">regex</span><span class="si">}</span><span class="s1">)&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">range_</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
        <span class="n">range_</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&lt;i&gt;read-only&lt;/i&gt;&#39;</span><span class="p">,</span> <span class="n">range_</span><span class="p">]</span> <span class="k">if</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span>
        <span class="n">range_</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&lt;i&gt;constant&lt;/i&gt;&#39;</span><span class="p">,</span> <span class="n">range_</span><span class="p">]</span> <span class="k">if</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;allow_None&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">range_</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&lt;i&gt;nullable&lt;/i&gt;&#39;</span><span class="p">,</span> <span class="n">range_</span><span class="p">]</span> <span class="k">if</span> <span class="n">s</span><span class="p">)</span>

    <span class="n">tooltip</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39; class=&quot;param-doc-tooltip&quot; data-tooltip=&quot;</span><span class="si">{</span><span class="n">escape</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">doc</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;&lt;tr&gt;&#39;</span>
        <span class="sa">f</span><span class="s1">&#39;  &lt;td&gt;&lt;p style=&quot;margin-bottom: 0px;&quot;</span><span class="si">{</span><span class="n">tooltip</span><span class="si">}</span><span class="s1">&gt;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&lt;/p&gt;&lt;/td&gt;&#39;</span>
        <span class="sa">f</span><span class="s1">&#39;  &lt;td style=&quot;max-width: 200px; text-align:left;&quot;&gt;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&lt;/td&gt;&#39;</span>
        <span class="sa">f</span><span class="s1">&#39;  &lt;td style=&quot;text-align:left;&quot;&gt;</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&lt;/td&gt;&#39;</span>
        <span class="sa">f</span><span class="s1">&#39;  &lt;td style=&quot;max-width: 300px;&quot;&gt;</span><span class="si">{</span><span class="n">range_</span><span class="si">}</span><span class="s1">&lt;/td&gt;&#39;</span>
        <span class="sa">f</span><span class="s1">&#39;&lt;/tr&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_parameterized_repr_html</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">open</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;HTML representation for a Parameterized object&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Parameterized</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;()&quot;</span>
        <span class="n">value_field</span> <span class="o">=</span> <span class="s1">&#39;Value&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">p</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">name</span>
        <span class="n">value_field</span> <span class="o">=</span> <span class="s1">&#39;Default&#39;</span>

    <span class="n">tooltip_css</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">.param-doc-tooltip{</span>
<span class="s2">  position: relative;</span>
<span class="s2">  cursor: help;</span>
<span class="s2">}</span>
<span class="s2">.param-doc-tooltip:hover:after{</span>
<span class="s2">  content: attr(data-tooltip);</span>
<span class="s2">  background-color: black;</span>
<span class="s2">  color: #fff;</span>
<span class="s2">  border-radius: 3px;</span>
<span class="s2">  padding: 10px;</span>
<span class="s2">  position: absolute;</span>
<span class="s2">  z-index: 1;</span>
<span class="s2">  top: -5px;</span>
<span class="s2">  left: 100%;</span>
<span class="s2">  margin-left: 10px;</span>
<span class="s2">  min-width: 250px;</span>
<span class="s2">}</span>
<span class="s2">.param-doc-tooltip:hover:before {</span>
<span class="s2">  content: &quot;&quot;;</span>
<span class="s2">  position: absolute;</span>
<span class="s2">  top: 50%;</span>
<span class="s2">  left: 100%;</span>
<span class="s2">  margin-top: -5px;</span>
<span class="s2">  border-width: 5px;</span>
<span class="s2">  border-style: solid;</span>
<span class="s2">  border-color: transparent black transparent transparent;</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="n">openstr</span> <span class="o">=</span> <span class="s2">&quot; open&quot;</span> <span class="k">if</span> <span class="nb">open</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">param_values</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_get_param_repr</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                       <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">param_values</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;&lt;style&gt;</span><span class="si">{</span><span class="n">tooltip_css</span><span class="si">}</span><span class="s1">&lt;/style&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="sa">f</span><span class="s1">&#39;&lt;details </span><span class="si">{</span><span class="n">openstr</span><span class="si">}</span><span class="s1">&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39; &lt;summary style=&quot;display:list-item; outline:none;&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="sa">f</span><span class="s1">&#39;  &lt;tt&gt;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">&lt;/tt&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39; &lt;/summary&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39; &lt;div style=&quot;padding-left:10px; padding-bottom:5px;&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;table style=&quot;max-width:100%; border:1px solid #AAAAAA;&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="sa">f</span><span class="s1">&#39;   &lt;tr&gt;&lt;th style=&quot;text-align:left;&quot;&gt;Name&lt;/th&gt;&lt;th style=&quot;text-align:left;&quot;&gt;</span><span class="si">{</span><span class="n">value_field</span><span class="si">}</span><span class="s1">&lt;/th&gt;&lt;th style=&quot;text-align:left;&quot;&gt;Type&lt;/th&gt;&lt;th&gt;Range&lt;/th&gt;&lt;/tr&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">contents</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;/table&gt;</span><span class="se">\n</span><span class="s1"> &lt;/div&gt;</span><span class="se">\n</span><span class="s1">&lt;/details&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="p">)</span>

<span class="c1"># _ClassPrivate and _InstancePrivate are the private namespaces of Parameterized</span>
<span class="c1"># classes and instance respectively, stored on the `_param__private` attribute.</span>
<span class="c1"># They are implemented with slots for performance reasons.</span>

<span class="k">class</span> <span class="nc">_ClassPrivate</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    parameters_state: dict</span>
<span class="sd">        Dict holding some transient states</span>
<span class="sd">    disable_instance_params: bool</span>
<span class="sd">        Whether to disable instance parameters</span>
<span class="sd">    renamed: bool</span>
<span class="sd">        Whethe the class has been renamed by a super class</span>
<span class="sd">    params: dict</span>
<span class="sd">        Dict of parameter_name:parameter</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;parameters_state&#39;</span><span class="p">,</span>
        <span class="s1">&#39;disable_instance_params&#39;</span><span class="p">,</span>
        <span class="s1">&#39;renamed&#39;</span><span class="p">,</span>
        <span class="s1">&#39;params&#39;</span><span class="p">,</span>
        <span class="s1">&#39;initialized&#39;</span><span class="p">,</span>
        <span class="s1">&#39;signature&#39;</span><span class="p">,</span>
        <span class="s1">&#39;explicit_no_refs&#39;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parameters_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">disable_instance_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">explicit_no_refs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">renamed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters_state</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;BATCH_WATCH&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># If true, Event and watcher objects are queued.</span>
                <span class="s2">&quot;TRIGGER&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;events&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># Queue of batched events</span>
                <span class="s2">&quot;watchers&quot;</span><span class="p">:</span> <span class="p">[]</span> <span class="c1"># Queue of batched watchers</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_state</span> <span class="o">=</span> <span class="n">parameters_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_instance_params</span> <span class="o">=</span> <span class="n">disable_instance_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renamed</span> <span class="o">=</span> <span class="n">renamed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explicit_no_refs</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">explicit_no_refs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">explicit_no_refs</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">slot</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span> <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_InstancePrivate</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    initialized: bool</span>
<span class="sd">        Flag that can be tested to see if e.g. constant Parameters can still be set</span>
<span class="sd">    parameters_state: dict</span>
<span class="sd">        Dict holding some transient states</span>
<span class="sd">    dynamic_watchers: defaultdict</span>
<span class="sd">        Dynamic watchers</span>
<span class="sd">    ref_watchers: list[Watcher]</span>
<span class="sd">        Watchers used for internal references</span>
<span class="sd">    params: dict</span>
<span class="sd">        Dict of parameter_name:parameter</span>
<span class="sd">    refs: dict</span>
<span class="sd">        Dict of parameter name:reference</span>
<span class="sd">    watchers: dict</span>
<span class="sd">        Dict of dict:</span>
<span class="sd">            parameter_name:</span>
<span class="sd">                parameter_attribute (e.g. &#39;value&#39;): list of `Watcher`s</span>
<span class="sd">    values: dict</span>
<span class="sd">        Dict of parameter name: value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;initialized&#39;</span><span class="p">,</span>
        <span class="s1">&#39;parameters_state&#39;</span><span class="p">,</span>
        <span class="s1">&#39;dynamic_watchers&#39;</span><span class="p">,</span>
        <span class="s1">&#39;params&#39;</span><span class="p">,</span>
        <span class="s1">&#39;async_refs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;refs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ref_watchers&#39;</span><span class="p">,</span>
        <span class="s1">&#39;syncing&#39;</span><span class="p">,</span>
        <span class="s1">&#39;watchers&#39;</span><span class="p">,</span>
        <span class="s1">&#39;values&#39;</span><span class="p">,</span>
        <span class="s1">&#39;explicit_no_refs&#39;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initialized</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">parameters_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dynamic_watchers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">refs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">watchers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">explicit_no_refs</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="n">initialized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explicit_no_refs</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">explicit_no_refs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">explicit_no_refs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syncing</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parameters_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters_state</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;BATCH_WATCH&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># If true, Event and watcher objects are queued.</span>
                <span class="s2">&quot;TRIGGER&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;events&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># Queue of batched events</span>
                <span class="s2">&quot;watchers&quot;</span><span class="p">:</span> <span class="p">[]</span> <span class="c1"># Queue of batched watchers</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_watchers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">async_refs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_state</span> <span class="o">=</span> <span class="n">parameters_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_watchers</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span> <span class="k">if</span> <span class="n">dynamic_watchers</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dynamic_watchers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">refs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">refs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">watchers</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">watchers</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">watchers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">slot</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span> <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>


<div class="viewcode-block" id="Parameterized"><a class="viewcode-back" href="../../reference/param/generated/param.Parameterized.html#param.Parameterized">[docs]</a><span class="k">class</span> <span class="nc">Parameterized</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ParameterizedMetaclass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for named objects that support Parameters and message</span>
<span class="sd">    formatting.</span>

<span class="sd">    Automatic object naming: Every Parameterized instance has a name</span>
<span class="sd">    parameter.  If the user doesn&#39;t designate a name=&lt;str&gt; argument</span>
<span class="sd">    when constructing the object, the object will be given a name</span>
<span class="sd">    consisting of its class name followed by a unique 5-digit number.</span>

<span class="sd">    Automatic parameter setting: The Parameterized __init__ method</span>
<span class="sd">    will automatically read the list of keyword parameters.  If any</span>
<span class="sd">    keyword matches the name of a Parameter (see Parameter class)</span>
<span class="sd">    defined in the object&#39;s class or any of its superclasses, that</span>
<span class="sd">    parameter in the instance will get the value given as a keyword</span>
<span class="sd">    argument.  For example:</span>

<span class="sd">      class Foo(Parameterized):</span>
<span class="sd">         xx = Parameter(default=1)</span>

<span class="sd">      foo = Foo(xx=20)</span>

<span class="sd">    in this case foo.xx gets the value 20.</span>

<span class="sd">    When initializing a Parameterized instance (&#39;foo&#39; in the example</span>
<span class="sd">    above), the values of parameters can be supplied as keyword</span>
<span class="sd">    arguments to the constructor (using parametername=parametervalue);</span>
<span class="sd">    these values will override the class default values for this one</span>
<span class="sd">    instance.</span>

<span class="sd">    If no &#39;name&#39; parameter is supplied, self.name defaults to the</span>
<span class="sd">    object&#39;s class name with a unique number appended to it.</span>

<span class="sd">    Message formatting: Each Parameterized instance has several</span>
<span class="sd">    methods for optionally printing output. This functionality is</span>
<span class="sd">    based on the standard Python &#39;logging&#39; module; using the methods</span>
<span class="sd">    provided here, wraps calls to the &#39;logging&#39; module&#39;s root logger</span>
<span class="sd">    and prepends each message with information about the instance</span>
<span class="sd">    from which the call was made. For more information on how to set</span>
<span class="sd">    the global logging level and change the default message prefix,</span>
<span class="sd">    see documentation for the &#39;logging&#39; module.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        String identifier for this object.&quot;&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Parameterized.__init__"><a class="viewcode-back" href="../../reference/param/generated/param.Parameterized.html#param.Parameterized.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">object_count</span>

        <span class="c1"># Setting a Parameter value in an __init__ block before calling</span>
        <span class="c1"># Parameterized.__init__ (via super() generally) already sets the</span>
        <span class="c1"># _InstancePrivate namespace over the _ClassPrivate namespace</span>
        <span class="c1"># (see Parameter.__set__) so we shouldn&#39;t override it here.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_param__private</span><span class="p">,</span> <span class="n">_InstancePrivate</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_param__private</span> <span class="o">=</span> <span class="n">_InstancePrivate</span><span class="p">(</span>
                <span class="n">explicit_no_refs</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">explicit_no_refs</span>
            <span class="p">)</span>

        <span class="c1"># Skip generating a custom instance name when a class in the hierarchy</span>
        <span class="c1"># has overriden the default of the `name` Parameter.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">default</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_generate_name</span><span class="p">()</span>
        <span class="n">refs</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_setup_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="n">object_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_setup_refs</span><span class="p">(</span><span class="n">deps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_update_deps</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">refs</span> <span class="o">=</span> <span class="n">refs</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1">#PARAM3_DEPRECATION</span>
    <span class="nd">@property</span>
    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;Use `inst.param.watchers` instead.&quot;</span><span class="p">,</span> <span class="n">warning_cat</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_param_watchers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">watchers</span>

    <span class="c1">#PARAM3_DEPRECATION</span>
    <span class="nd">@_param_watchers</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@_deprecated</span><span class="p">(</span><span class="n">extra_msg</span><span class="o">=</span><span class="s2">&quot;Use `inst.param.watchers = ...` instead.&quot;</span><span class="p">,</span> <span class="n">warning_cat</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_param_watchers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">watchers</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># &#39;Special&#39; methods</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the object&#39;s state: return a dictionary that is a shallow</span>
<span class="sd">        copy of the object&#39;s __dict__ and that also includes the</span>
<span class="sd">        object&#39;s __slots__ (if it has any).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Unclear why this is a copy and not simply state.update(self.__dict__)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">get_occupied_slots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">state</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">slot</span><span class="p">)</span>

        <span class="c1"># Note that Parameterized object pickling assumes that</span>
        <span class="c1"># attributes to be saved are only in __dict__ or __slots__</span>
        <span class="c1"># (the standard Python places to store attributes, so that&#39;s a</span>
        <span class="c1"># reasonable assumption). (Additionally, class attributes that</span>
        <span class="c1"># are Parameters are also handled, even when they haven&#39;t been</span>
        <span class="c1"># instantiated - see PickleableClassAttributes.)</span>

        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore objects from the state dictionary to this object.</span>

<span class="sd">        During this process the object is considered uninitialized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">explicit_no_refs</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">explicit_no_refs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param__private</span> <span class="o">=</span> <span class="n">_InstancePrivate</span><span class="p">(</span><span class="n">explicit_no_refs</span><span class="o">=</span><span class="n">explicit_no_refs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">_param__private</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_param__private&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_param__private</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_param__private</span> <span class="o">=</span> <span class="n">_InstancePrivate</span><span class="p">(</span><span class="n">explicit_no_refs</span><span class="o">=</span><span class="n">explicit_no_refs</span><span class="p">)</span>

        <span class="c1"># When making a copy the internal watchers have to be</span>
        <span class="c1"># recreated and point to the new instance</span>
        <span class="k">if</span> <span class="n">_param__private</span><span class="o">.</span><span class="n">watchers</span><span class="p">:</span>
            <span class="n">param_watchers</span> <span class="o">=</span> <span class="n">_param__private</span><span class="o">.</span><span class="n">watchers</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">param_watchers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">watchers</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">new_watchers</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">watcher</span> <span class="ow">in</span> <span class="n">watchers</span><span class="p">:</span>
                        <span class="n">watcher_args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">watcher</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">watcher</span><span class="o">.</span><span class="n">inst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">watcher_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
                        <span class="n">fn</span> <span class="o">=</span> <span class="n">watcher</span><span class="o">.</span><span class="n">fn</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s1">&#39;_watcher_name&#39;</span><span class="p">):</span>
                            <span class="n">watcher_args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">_m_caller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">_watcher_name</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">get_method_owner</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="ow">is</span> <span class="n">watcher</span><span class="o">.</span><span class="n">inst</span><span class="p">:</span>
                            <span class="n">watcher_args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                        <span class="n">new_watchers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Watcher</span><span class="p">(</span><span class="o">*</span><span class="n">watcher_args</span><span class="p">))</span>
                    <span class="n">param_watchers</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_watchers</span>

        <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;param&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param__private</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@_recursive_repr</span><span class="p">()</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide a nearly valid Python representation that could be used to recreate</span>
<span class="sd">        the item with its parameters, if executed in the appropriate environment.</span>

<span class="sd">        Returns &#39;classname(parameter1=x,parameter2=y,...)&#39;, listing</span>
<span class="sd">        all the parameters of this object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="n">val</span><span class="si">!r}</span><span class="s1">&#39;</span>
                        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span> <span class="c1"># Handle recursion in parameter depth</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a short representation of the name and class of this object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&gt;&quot;</span></div>


<span class="k">def</span> <span class="nf">print_all_param_defaults</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print the default values for all imported Parameters.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;_______________________________________________________________________________&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;                           Parameter Default Values&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="n">descendents</span><span class="p">(</span><span class="n">Parameterized</span><span class="p">)</span>
    <span class="n">classes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="n">c</span><span class="o">.</span><span class="n">print_param_defaults</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;_______________________________________________________________________________&quot;</span><span class="p">)</span>



<span class="c1"># As of Python 2.6+, a fn&#39;s **args no longer has to be a</span>
<span class="c1"># dictionary. This might allow us to use a decorator to simplify using</span>
<span class="c1"># ParamOverrides (if that does indeed make them simpler to use).</span>
<span class="c1"># http://docs.python.org/whatsnew/2.6.html</span>
<div class="viewcode-block" id="ParamOverrides"><a class="viewcode-back" href="../../reference/param/generated/param.ParamOverrides.html#param.ParamOverrides">[docs]</a><span class="k">class</span> <span class="nc">ParamOverrides</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dictionary that returns the attribute of a specified object if</span>
<span class="sd">    that attribute is not present in itself.</span>

<span class="sd">    Used to override the parameters of an object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># NOTE: Attribute names of this object block parameters of the</span>
    <span class="c1"># same name, so all attributes of this object should have names</span>
    <span class="c1"># starting with an underscore (_).</span>

<div class="viewcode-block" id="ParamOverrides.__init__"><a class="viewcode-back" href="../../reference/param/generated/param.ParamOverrides.html#param.ParamOverrides.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overridden</span><span class="p">,</span><span class="n">dict_</span><span class="p">,</span><span class="n">allow_extra_keywords</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        If allow_extra_keywords is False, then all keys in the</span>
<span class="sd">        supplied dict_ must match parameter names on the overridden</span>
<span class="sd">        object (otherwise a warning will be printed).</span>

<span class="sd">        If allow_extra_keywords is True, then any items in the</span>
<span class="sd">        supplied dict_ that are not also parameters of the overridden</span>
<span class="sd">        object will be available via the extra_keywords() method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This method should be fast because it&#39;s going to be</span>
        <span class="c1"># called a lot. This _might_ be faster (not tested):</span>
        <span class="c1">#  def __init__(self,overridden,**kw):</span>
        <span class="c1">#      ...</span>
        <span class="c1">#      dict.__init__(self,**kw)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overridden</span> <span class="o">=</span> <span class="n">overridden</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dict_</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">allow_extra_keywords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extra_keywords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_extra_keywords</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_params</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">extra_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary containing items from the originally</span>
<span class="sd">        supplied `dict_` whose names are not parameters of the</span>
<span class="sd">        overridden object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_keywords</span>

    <span class="k">def</span> <span class="nf">param_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary containing items from the originally</span>
<span class="sd">        supplied `dict_` whose names are parameters of the</span>
<span class="sd">        overridden object (i.e. not extra keywords/parameters).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra_keywords</span><span class="p">()}</span>

    <span class="k">def</span> <span class="fm">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="c1"># Return &#39;name&#39; from the overridden object</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_overridden</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># As dict.__repr__, but indicate the overridden object</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; overriding params from </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_overridden</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="c1"># Provide &#39;dot&#39; access to entries in the dictionary.</span>
        <span class="c1"># (This __getattr__ method is called only if &#39;name&#39; isn&#39;t an</span>
        <span class="c1"># attribute of self.)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="c1"># Attributes whose name starts with _ are set on self (as</span>
        <span class="c1"># normal), but all other attributes are inserted into the</span>
        <span class="c1"># dictionary.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overridden</span><span class="o">.</span><span class="n">param</span>

    <span class="k">def</span> <span class="nf">_check_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print a warning if params contains something that is not a</span>
<span class="sd">        Parameter of the overridden object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">overridden_object_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_overridden</span><span class="o">.</span><span class="n">param</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">overridden_object_params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; will be ignored (not a Parameter).&quot;</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_extra_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return any items in params that are not also</span>
<span class="sd">        parameters of the overridden object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extra_keywords</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">overridden_object_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_overridden</span><span class="o">.</span><span class="n">param</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">overridden_object_params</span><span class="p">:</span>
                <span class="n">extra_keywords</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="n">val</span>
                <span class="c1"># Could remove name from params (i.e. del params[name])</span>
                <span class="c1"># so that it&#39;s only available via extra_keywords()</span>
        <span class="k">return</span> <span class="n">extra_keywords</span></div>


<span class="c1"># Helper function required by ParameterizedFunction.__reduce__</span>
<span class="k">def</span> <span class="nf">_new_parameterized</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Parameterized</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>


<div class="viewcode-block" id="ParameterizedFunction"><a class="viewcode-back" href="../../reference/param/generated/param.ParameterizedFunction.html#param.ParameterizedFunction">[docs]</a><span class="k">class</span> <span class="nc">ParameterizedFunction</span><span class="p">(</span><span class="n">Parameterized</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acts like a Python function, but with arguments that are Parameters.</span>

<span class="sd">    Implemented as a subclass of Parameterized that, when instantiated,</span>
<span class="sd">    automatically invokes __call__ and returns the result, instead of</span>
<span class="sd">    returning an instance of the class.</span>

<span class="sd">    To obtain an instance of this class, call instance().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s2">&quot;()&quot;</span>

    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">instance</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an instance of this class, copying parameters from any</span>
<span class="sd">        existing instance provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span> <span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span><span class="n">ParameterizedMetaclass</span><span class="p">):</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_or_cls</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">params</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="vm">__class__</span>

        <span class="n">inst</span><span class="o">=</span><span class="n">Parameterized</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">Parameterized</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>  <span class="n">inst</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>                 <span class="n">inst</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">inst</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">class_</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="c1"># Create and __call__() an instance of this class.</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">class_</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">_set_name</span><span class="p">(</span><span class="n">class_</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inst</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Subclasses must implement __call__.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Control reconstruction (during unpickling and copying):</span>
        <span class="c1"># ensure that ParameterizedFunction.__new__ is skipped</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">ParameterizedFunction</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Here it&#39;s necessary to use a function defined at the</span>
        <span class="c1"># module level rather than Parameterized.__new__ directly</span>
        <span class="c1"># because otherwise pickle will find .__new__&#39;s module to be</span>
        <span class="c1"># __main__. Pretty obscure aspect of pickle.py...</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">_new_parameterized</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,),</span><span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imports</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    &quot;</span><span class="p">,</span><span class="n">unknown_value</span><span class="o">=</span><span class="s1">&#39;&lt;?&gt;&#39;</span><span class="p">,</span>
                <span class="n">qualify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Same as self.param.pprint, except that X.classname(Y</span>
<span class="sd">        is replaced with X.classname.instance(Y</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">imports</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span>
                              <span class="n">unknown_value</span><span class="o">=</span><span class="n">unknown_value</span><span class="p">,</span>
                              <span class="n">qualify</span><span class="o">=</span><span class="n">qualify</span><span class="p">,</span><span class="n">separator</span><span class="o">=</span><span class="n">separator</span><span class="p">)</span>
        <span class="n">classname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.</span><span class="si">%s</span><span class="s2">(&quot;</span><span class="o">%</span><span class="n">classname</span><span class="p">,</span><span class="s2">&quot;.</span><span class="si">%s</span><span class="s2">.instance(&quot;</span><span class="o">%</span><span class="n">classname</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">default_label_formatter</span><span class="p">(</span><span class="n">ParameterizedFunction</span><span class="p">):</span>
    <span class="s2">&quot;Default formatter to turn parameter names into appropriate widget labels.&quot;</span>

    <span class="n">capitalize</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Whether or not the label should be capitalized.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">replace_underscores</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Whether or not underscores should be replaced with spaces.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">overrides</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">{},</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Allows custom labels to be specified for specific parameter</span>
<span class="s2">        names using a dictionary where key is the parameter name and the</span>
<span class="s2">        value is the desired label.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">overrides</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">overrides</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_underscores</span><span class="p">:</span>
            <span class="n">pname</span> <span class="o">=</span> <span class="n">pname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">capitalize</span><span class="p">:</span>
            <span class="n">pname</span> <span class="o">=</span> <span class="n">pname</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">pname</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">pname</span>


<span class="n">label_formatter</span> <span class="o">=</span> <span class="n">default_label_formatter</span>


<span class="c1"># PARAM3_DEPRECATION: Should be able to remove this; was originally</span>
<span class="c1"># adapted from OProperty from</span>
<span class="c1"># infinitesque.net/articles/2005/enhancing%20Python&#39;s%20property.xhtml</span>
<span class="c1"># but since python 2.6 the getter, setter, and deleter attributes of</span>
<span class="c1"># a property should provide similar functionality already.</span>
<span class="k">class</span> <span class="nc">overridable_property</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The same as Python&#39;s &quot;property&quot; attribute, but allows the accessor</span>
<span class="sd">    methods to be overridden in subclasses.</span>

<span class="sd">    .. deprecated:: 2.0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Delays looking up the accessors until they&#39;re needed, rather</span>
    <span class="c1"># than finding them when the class is first created.</span>

    <span class="c1"># Based on the emulation of PyProperty_Type() in Objects/descrobject.c</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fdel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;overridable_property has been deprecated.&quot;</span><span class="p">,</span>
            <span class="n">category</span><span class="o">=</span><span class="n">_ParamDeprecationWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fget</span> <span class="o">=</span> <span class="n">fget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fset</span> <span class="o">=</span> <span class="n">fset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fdel</span> <span class="o">=</span> <span class="n">fdel</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">objtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;unreadable attribute&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;&lt;lambda&gt;&#39;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)()</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;can&#39;t set attribute&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fset</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;&lt;lambda&gt;&#39;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fset</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fset</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fset</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;can&#39;t delete attribute&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdel</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;&lt;lambda&gt;&#39;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdel</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fdel</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdel</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)()</span>
</pre></div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
       Copyright 2003-2024 Holoviz contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item"><p class="last-updated">
  Last updated on 2024-03-13.
  <br/>
</p></div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>